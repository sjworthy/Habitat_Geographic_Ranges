---
title: "Range.Maps"
output:
  html_document: default
  pdf_document: default
date: "2025-01-08"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Location of files originally: https://github.com/wpetry/USTreeAtlas

```{r}
library(sp)
library(raster)
library(sf)
library(maps)
library(tidyverse)
library(tigris)
options(tigris_use_cache = TRUE)
library(CoordinateCleaner)
library(BIEN)
library(divvy)
```

Read in the GBIF data points

```{r}
gbif = read.csv("../Formatted.Data/gbif.filtered.csv")
```

Subset for Abies balsamea

```{r}
ABBA.occ = gbif %>%
  filter(species == "Abies balsamea") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
ABBA.range = st_read("../../USTreeAtlas/shp/abiebals/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(ABBA.range)  <- 4267 
```

```{r}
maps::map(database = "state")
plot(ABBA.range$geometry, col="red", add=T)
```

```{r}
us_states <- states(cb = TRUE)
```

```{r}
continental_states <- us_states %>%
  filter(!NAME %in% (c("Alaska","American Samoa","Guam","Commonwealth of the Northern Mariana Islands","Hawaii","United States Virgin Islands",
                       "Puerto Rico")))
```

```{r}
states.map = continental_states %>%
  st_as_sf %>%
  st_transform(st_crs(ABBA.range))
  
```

```{r}
ggplot(states.map) +
  geom_sf()
```

```{r}
ggplot(ABBA.range) +
  geom_sf()
```

```{r}
ggplot()+
  geom_sf(data = states.map)+
  geom_sf(data = ABBA.range, col = "red")
```

```{r}
ABBA_clipped = st_intersection(ABBA.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = ABBA_clipped, col = "red")+
  theme_classic()
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = ABBA_clipped, col = "red", linewidth = 2)+
  geom_point(data = ABBA.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
ABBA_clipped$species = "Abies balsamea"
ABBA_flag = cc_iucn(x = ABBA.occ, range = ABBA_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
ABBA_occ_final = ABBA.occ[ABBA_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = ABBA_clipped, col = "red", linewidth = 2)+
  geom_point(data = ABBA_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/ABBA.range.pdf", width = 12, height = 8)
```

Estimating Range Size for Abies balsamea: Output includes number of occurrence points, x and y centroids, latitudinal range (degrees), great circle distance (km), mean pairwise distance (km), summed minimum spanning tree length (km)

```{r}
ABBA.coords = ABBA_occ_final[c(3,2)]
rangeSize(ABBA.coords, crs = "epsg:4267")
```



### Repeat basics of steps above for all other species ####

Subset for Abies fraseri

```{r}
ABFR.occ = gbif %>%
  filter(species == "Abies fraseri") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
ABFR.range = st_read("../../USTreeAtlas/shp/abiefras/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(ABFR.range)  <- 4267 
```

```{r}
ABFR_clipped = st_intersection(ABFR.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = ABFR_clipped, col = "red", linewidth = 2)+
  geom_point(data = ABFR.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
ABFR_clipped$species = "Abies fraseri"
ABFR_flag = cc_iucn(x = ABFR.occ, range = ABFR_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
ABFR_occ_final = ABFR.occ[ABFR_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = ABFR_clipped, col = "red", linewidth = 2)+
  geom_point(data = ABFR_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/ABFR.range.pdf", width = 12, height = 8)
```

```{r}
ABFR.coords = ABFR_occ_final[c(3,2)]
rangeSize(ABFR.coords, crs = "epsg:4267")
```

Subset for Acer barbatum

```{r}
ACBA3.occ = gbif %>%
  filter(species == "Acer barbatum") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
ACBA3.range = st_read("../../USTreeAtlas/shp/acerbarb/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(ACBA3.range)  <- 4267 
```

```{r}
ACBA3_clipped = st_intersection(ACBA3.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = ACBA3_clipped, col = "red", linewidth = 2)+
  geom_point(data = ACBA3.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
ACBA3_clipped$species = "Acer barbatum"
ACBA3_flag = cc_iucn(x = ACBA3.occ, range = ACBA3_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
ACBA3_occ_final = ACBA3.occ[ACBA3_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = ACBA3_clipped, col = "red", linewidth = 2)+
  geom_point(data = ACBA3_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/ACBA3.range.pdf", width = 12, height = 8)
```

```{r}
ACBA3.coords = ACBA3_occ_final[c(3,2)]
rangeSize(ACBA3.coords, crs = "epsg:4267")
```


Subset for Acer leucoderme

```{r}
ACLE.occ = gbif %>%
  filter(species == "Acer leucoderme") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
ACLE.range = st_read("../../USTreeAtlas/shp/acerleuc/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(ACLE.range)  <- 4267 
```

```{r}
ACLE_clipped = st_intersection(ACLE.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = ACLE_clipped, col = "red", linewidth = 2)+
  geom_point(data = ACLE.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
ACLE_clipped$species = "Acer leucoderme"
ACLE_flag = cc_iucn(x = ACLE.occ, range = ACLE_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
ACLE_occ_final = ACLE.occ[ACLE_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = ACLE_clipped, col = "red", linewidth = 2)+
  geom_point(data = ACLE_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/ACLE.range.pdf", width = 12, height = 8)
```

```{r}
ACLE.coords = ACLE_occ_final[c(3,2)]
rangeSize(ACLE.coords, crs = "epsg:4267")
```

Subset for Acer negundo

```{r}
ACNE3.occ = gbif %>%
  filter(species == "Acer negundo") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
ACNE3.range = st_read("../../USTreeAtlas/shp/acernegu/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(ACNE3.range)  <- 4267 
```

```{r}
ACNE3_clipped = st_intersection(ACNE3.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = ACNE3_clipped, col = "red", linewidth = 2)+
  geom_point(data = ACNE3.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
ACNE3_clipped$species = "Acer negundo"
ACNE3_flag = cc_iucn(x = ACNE3.occ, range = ACNE3_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
ACNE3_occ_final = ACNE3.occ[ACNE3_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = ACNE3_clipped, col = "red", linewidth = 2)+
  geom_point(data = ACNE3_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/ACNE3.range.pdf", width = 12, height = 8)
```

```{r}
ACNE3.coords = ACNE3_occ_final[c(3,2)]
rangeSize(ACNE3.coords, crs = "epsg:4267")
```

Subset for Acer nigrum

```{r}
ACNI5.occ = gbif %>%
  filter(species == "Acer nigrum") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
ACNI5.range = st_read("../../USTreeAtlas/shp/acernigr/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(ACNI5.range)  <- 4267 
```

```{r}
ACNI5_clipped = st_intersection(ACNI5.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = ACNI5_clipped, col = "red", linewidth = 2)+
  geom_point(data = ACNI5.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
ACNI5_clipped$species = "Acer nigrum"
ACNI5_flag = cc_iucn(x = ACNI5.occ, range = ACNI5_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
ACNI5_occ_final = ACNI5.occ[ACNI5_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = ACNI5_clipped, col = "red", linewidth = 2)+
  geom_point(data = ACNI5_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/ACNI5.range.pdf", width = 12, height = 8)
```

```{r}
ACNI5.coords = ACNI5_occ_final[c(3,2)]
rangeSize(ACNI5.coords, crs = "epsg:4267")
```

Subset for Acer pensylvanicum

```{r}
ACPE.occ = gbif %>%
  filter(species == "Acer pensylvanicum") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
ACPE.range = st_read("../../USTreeAtlas/shp/acerpens/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(ACPE.range)  <- 4267 
```

```{r}
ACPE_clipped = st_intersection(ACPE.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = ACPE_clipped, col = "red", linewidth = 2)+
  geom_point(data = ACPE.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
ACPE_clipped$species = "Acer pensylvanicum"
ACPE_flag = cc_iucn(x = ACPE.occ, range = ACPE_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
ACPE_occ_final = ACPE.occ[ACPE_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = ACPE_clipped, col = "red", linewidth = 2)+
  geom_point(data = ACPE_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/ACPE.range.pdf", width = 12, height = 8)
```

```{r}
ACPE.coords = ACPE_occ_final[c(3,2)]
rangeSize(ACPE.coords, crs = "epsg:4267")
```

Subset for Acer rubrum

```{r}
ACRU.occ = gbif %>%
  filter(species == "Acer rubrum") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
ACRU.range = st_read("../../USTreeAtlas/shp/acerrubr/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(ACRU.range)  <- 4267 
```

```{r}
ACRU_clipped = st_intersection(ACRU.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = ACRU_clipped, col = "red", linewidth = 2)+
  geom_point(data = ACRU.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
ACRU_clipped$species = "Acer rubrum"
ACRU_flag = cc_iucn(x = ACRU.occ, range = ACRU_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
ACRU_occ_final = ACRU.occ[ACRU_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = ACRU_clipped, col = "red", linewidth = 2)+
  geom_point(data = ACRU_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/ACRU.range.pdf", width = 12, height = 8)
```

```{r}
ACRU.coords = ACRU_occ_final[c(3,2)]
rangeSize(ACRU.coords, crs = "epsg:4267")
```

Subset for Acer saccharinum

```{r}
ACSA2.occ = gbif %>%
  filter(species == "Acer saccharinum") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
ACSA2.range = st_read("../../USTreeAtlas/shp/acersacc/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(ACSA2.range)  <- 4267 
```

```{r}
ACSA2_clipped = st_intersection(ACSA2.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = ACSA2_clipped, col = "red", linewidth = 2)+
  geom_point(data = ACSA2.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
ACSA2_clipped$species = "Acer saccharinum"
ACSA2_flag = cc_iucn(x = ACSA2.occ, range = ACSA2_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
ACSA2_occ_final = ACSA2.occ[ACSA2_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = ACSA2_clipped, col = "red", linewidth = 2)+
  geom_point(data = ACSA2_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/ACSA2.range.pdf", width = 12, height = 8)
```

```{r}
ACSA2.coords = ACSA2_occ_final[c(3,2)]
rangeSize(ACSA2.coords, crs = "epsg:4267")
```

Subset for Acer saccharum

```{r}
ACSA3.occ = gbif %>%
  filter(species == "Acer saccharum") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
ACSA3.range = st_read("../../USTreeAtlas/shp/acersacr/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(ACSA3.range)  <- 4267 
```

```{r}
ACSA3_clipped = st_intersection(ACSA3.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = ACSA3_clipped, col = "red", linewidth = 2)+
  geom_point(data = ACSA3.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
ACSA3_clipped$species = "Acer saccharum"
ACSA3_flag = cc_iucn(x = ACSA3.occ, range = ACSA3_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
ACSA3_occ_final = ACSA3.occ[ACSA3_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = ACSA3_clipped, col = "red", linewidth = 2)+
  geom_point(data = ACSA3_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/ACSA3.range.pdf", width = 12, height = 8)
```

```{r}
ACSA3.coords = ACSA3_occ_final[c(3,2)]
rangeSize(ACSA3.coords, crs = "epsg:4267")
```

Subset for Acer spicatum

```{r}
ACSP2.occ = gbif %>%
  filter(species == "Acer spicatum") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
ACSP2.range = st_read("../../USTreeAtlas/shp/acerspic/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(ACSP2.range)  <- 4267 
```

```{r}
ACSP2_clipped = st_intersection(ACSP2.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = ACSP2_clipped, col = "red", linewidth = 2)+
  geom_point(data = ACSP2.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
ACSP2_clipped$species = "Acer spicatum"
ACSP2_flag = cc_iucn(x = ACSP2.occ, range = ACSP2_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
ACSP2_occ_final = ACSP2.occ[ACSP2_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = ACSP2_clipped, col = "red", linewidth = 2)+
  geom_point(data = ACSP2_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/ACSP2.range.pdf", width = 12, height = 8)
```

```{r}
ACSP2.coords = ACSP2_occ_final[c(3,2)]
rangeSize(ACSP2.coords, crs = "epsg:4267")
```

Subset for Aesculus flava. Little range map not available.

```{r}
AEFL.occ = gbif %>%
  filter(species == "Aesculus flava") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Get range map from BIEN

```{r}
(AEFL.range.sf <- BIEN_ranges_load_species('Aesculus flava'))
```
The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The BIEN ranges are WG84.

```{r}
AEFL.range.2 = AEFL.range.sf %>%
  st_transform(st_crs(states.map))
```

```{r}
AEFL.range.3 = terra::vect(AEFL.range.2)
states.map.2 = terra::vect(states.map)
```

```{r}
AEFL.range.4 = terra::intersect(AEFL.range.3, states.map.2)
```

```{r}
AEFL.range.5 = st_as_sf(AEFL.range.4)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(dat = AEFL.range.5, col = "red", linewidth = 2)+
  geom_point(data = AEFL.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/AEFL.range.pdf", width = 12, height = 8)
```

```{r}
AEFL.coords = AEFL_occ_final[c(3,2)]
rangeSize(AEFL.coords, crs = "epsg:4267")
```

Subset for Aesculus glabra

```{r}
AEGL.occ = gbif %>%
  filter(species == "Aesculus glabra") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
AEGL.range = st_read("../../USTreeAtlas/shp/aescglab/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(AEGL.range)  <- 4267 
```

```{r}
AEGL_clipped = st_intersection(AEGL.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = AEGL_clipped, col = "red", linewidth = 2)+
  geom_point(data = AEGL.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
AEGL_clipped$species = "Aesculus glabra"
AEGL_flag = cc_iucn(x = AEGL.occ, range = AEGL_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
AEGL_occ_final = AEGL.occ[AEGL_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = AEGL_clipped, col = "red", linewidth = 2)+
  geom_point(data = AEGL_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/AEGL.range.pdf", width = 12, height = 8)
```

```{r}
AEGL.coords = AEGL_occ_final[c(3,2)]
rangeSize(AEGL.coords, crs = "epsg:4267")
```

Subset for Ailanthus altissima. Little range map not available.

```{r}
AIAL.occ = gbif %>%
  filter(species == "Ailanthus altissima") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Get range map from BIEN

```{r}
(AIAL.range.sf <- BIEN_ranges_load_species('Ailanthus altissima'))
```
The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The BIEN ranges are WG84.

```{r}
AIAL.range.2 = AIAL.range.sf %>%
  st_transform(st_crs(states.map))
```

```{r}
AIAL.range.3 = terra::vect(AIAL.range.2)
states.map.2 = terra::vect(states.map)
```

```{r}
AIAL.range.4 = terra::intersect(AIAL.range.3, states.map.2)
```

```{r}
AIAL.range.5 = st_as_sf(AIAL.range.4)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(dat = AIAL.range.5, col = "red", linewidth = 2)+
  geom_point(data = AIAL.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
AIAL.range.5$species = "Ailanthus altissima"
AIAL_flag = cc_iucn(x = AIAL.occ, range = AIAL.range.5, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```


```{r}
AIAL.occ_final = AIAL.occ[AIAL_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(dat = AIAL.range.5, col = "red", linewidth = 2)+
  geom_point(data = AIAL.occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/AIAL.range.pdf", width = 12, height = 8)
```

```{r}
AIAL.coords = AIAL_occ_final[c(3,2)]
rangeSize(AIAL.coords, crs = "epsg:4267")
```

Subset for Annona glabra. Little range map not available.

```{r}
ANGL4.occ = gbif %>%
  filter(species == "Annona glabra") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Get range map from BIEN

```{r}
(ANGL4.range.sf <- BIEN_ranges_load_species('Annona glabra'))
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The BIEN ranges are WG84.

```{r}
ANGL4.range.2 = ANGL4.range.sf %>%
  st_transform(st_crs(states.map))
```

```{r}
ANGL4.range.3 = terra::vect(ANGL4.range.2)
states.map.2 = terra::vect(states.map)
```

```{r}
ANGL4.range.4 = terra::intersect(ANGL4.range.3, states.map.2)
```

```{r}
ANGL4.range.5 = st_as_sf(ANGL4.range.4)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(dat = ANGL4.range.5, col = "red", linewidth = 2)+
  geom_point(data = ANGL4.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/ANGL4.range.pdf", width = 12, height = 8)
```

```{r}
ANGL4.coords = ANGL4_occ_final[c(3,2)]
rangeSize(ANGL4.coords, crs = "epsg:4267")
```

Subset for Asimina triloba

```{r}
ASTR.occ = gbif %>%
  filter(species == "Asimina triloba") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
ASTR.range = st_read("../../USTreeAtlas/shp/asimtril/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(ASTR.range)  <- 4267 
```

```{r}
ASTR_clipped = st_intersection(ASTR.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = ASTR_clipped, col = "red", linewidth = 2)+
  geom_point(data = ASTR.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
ASTR_clipped$species = "Asimina triloba"
ASTR_flag = cc_iucn(x = ASTR.occ, range = ASTR_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
ASTR_occ_final = ASTR.occ[ASTR_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = ASTR_clipped, col = "red", linewidth = 2)+
  geom_point(data = ASTR_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/ASTR.range.pdf", width = 12, height = 8)
```

```{r}
ASTR.coords = ASTR_occ_final[c(3,2)]
rangeSize(ASTR.coords, crs = "epsg:4267")
```


Subset for Betula alleghaniensis

```{r}
BEAL2.occ = gbif %>%
  filter(species == "Betula alleghaniensis") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
BEAL2.range = st_read("../../USTreeAtlas/shp/betualle/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(BEAL2.range)  <- 4267 
```

```{r}
BEAL2_clipped = st_intersection(BEAL2.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = BEAL2_clipped, col = "red", linewidth = 2)+
  geom_point(data = BEAL2.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
BEAL2_clipped$species = "Betula alleghaniensis"
BEAL2_flag = cc_iucn(x = BEAL2.occ, range = BEAL2_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
BEAL2_occ_final = BEAL2.occ[BEAL2_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = BEAL2_clipped, col = "red", linewidth = 2)+
  geom_point(data = BEAL2_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/BEAL2.range.pdf", width = 12, height = 8)
```

```{r}
BEAL2.coords = BEAL2_occ_final[c(3,2)]
rangeSize(BEAL2.coords, crs = "epsg:4267")
```

Subset for Betula lenta

```{r}
BELE.occ = gbif %>%
  filter(species == "Betula lenta") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
BELE.range = st_read("../../USTreeAtlas/shp/betulent/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(BELE.range)  <- 4267 
```

```{r}
BELE_clipped = st_intersection(BELE.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = BELE_clipped, col = "red", linewidth = 2)+
  geom_point(data = BELE.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
BELE_clipped$species = "Betula lenta"
BELE_flag = cc_iucn(x = BELE.occ, range = BELE_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
BELE_occ_final = BELE.occ[BELE_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = BELE_clipped, col = "red", linewidth = 2)+
  geom_point(data = BELE_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/BELE.range.pdf", width = 12, height = 8)
```

```{r}
BELE.coords = BELE_occ_final[c(3,2)]
rangeSize(BELE.coords, crs = "epsg:4267")
```

Subset for Betula nigra

```{r}
BENI.occ = gbif %>%
  filter(species == "Betula nigra") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
BENI.range = st_read("../../USTreeAtlas/shp/betunigr/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(BENI.range)  <- 4267 
```

```{r}
BENI_clipped = st_intersection(BENI.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = BENI_clipped, col = "red", linewidth = 2)+
  geom_point(data = BENI.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
BENI_clipped$species = "Betula nigra"
BENI_flag = cc_iucn(x = BENI.occ, range = BENI_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
BENI_occ_final = BENI.occ[BENI_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = BENI_clipped, col = "red", linewidth = 2)+
  geom_point(data = BENI_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/BENI.range.pdf", width = 12, height = 8)
```

```{r}
BENI.coords = BENI_occ_final[c(3,2)]
rangeSize(BENI.coords, crs = "epsg:4267")
```

Subset for Betula papyrifera

```{r}
BEPA.occ = gbif %>%
  filter(species == "Betula papyrifera") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
BEPA.range = st_read("../../USTreeAtlas/shp/betupapy/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(BEPA.range)  <- 4267 
```

```{r}
BEPA_clipped = st_intersection(BEPA.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = BEPA_clipped, col = "red", linewidth = 2)+
  geom_point(data = BEPA.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
BEPA_clipped$species = "Betula papyrifera"
BEPA_flag = cc_iucn(x = BEPA.occ, range = BEPA_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
BEPA_occ_final = BEPA.occ[BEPA_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = BEPA_clipped, col = "red", linewidth = 2)+
  geom_point(data = BEPA_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/BEPA.range.pdf", width = 12, height = 8)
```

```{r}
BEPA.coords = BEPA_occ_final[c(3,2)]
rangeSize(BEPA.coords, crs = "epsg:4267")
```

Subset for Betula populifolia

```{r}
BEPO.occ = gbif %>%
  filter(species == "Betula populifolia") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
BEPO.range = st_read("../../USTreeAtlas/shp/betupopu/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(BEPO.range)  <- 4267 
```

```{r}
BEPO_clipped = st_intersection(BEPO.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = BEPO_clipped, col = "red", linewidth = 2)+
  geom_point(data = BEPO.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
BEPO_clipped$species = "Betula populifolia"
BEPO_flag = cc_iucn(x = BEPO.occ, range = BEPO_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
BEPO_occ_final = BEPO.occ[BEPO_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = BEPO_clipped, col = "red", linewidth = 2)+
  geom_point(data = BEPO_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/BEPO.range.pdf", width = 12, height = 8)
```

```{r}
BEPO.coords = BEPO_occ_final[c(3,2)]
rangeSize(BEPO.coords, crs = "epsg:4267")
```

Subset for Carpinus caroliniana

```{r}
CACA18.occ = gbif %>%
  filter(species == "Carpinus caroliniana") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
CACA18.range = st_read("../../USTreeAtlas/shp/carpcaro/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(CACA18.range)  <- 4267 
```

```{r}
CACA18_clipped = st_intersection(CACA18.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = CACA18_clipped, col = "red", linewidth = 2)+
  geom_point(data = CACA18.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
CACA18_clipped$species = "Carpinus caroliniana"
CACA18_flag = cc_iucn(x = CACA18.occ, range = CACA18_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
CACA18_occ_final = CACA18.occ[CACA18_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = CACA18_clipped, col = "red", linewidth = 2)+
  geom_point(data = CACA18_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/CACA18.range.pdf", width = 12, height = 8)
```

```{r}
CACA18.coords = CACA18_occ_final[c(3,2)]
rangeSize(CACA18.coords, crs = "epsg:4267")
```

Subset for Carya alba. Little range map unavailable.

```{r}
CAAL27.occ = gbif %>%
  filter(species == "Carya alba") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Get range map from BIEN

```{r}
(CAAL27.range.sf <- BIEN_ranges_load_species('Carya alba'))
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The BIEN ranges are WG84.

```{r}
CAAL27.range.2 = CAAL27.range.sf %>%
  st_transform(st_crs(states.map))
```

```{r}
CAAL27.range.3 = terra::vect(CAAL27.range.2)
states.map.2 = terra::vect(states.map)
```

```{r}
CAAL27.range.4 = terra::intersect(CAAL27.range.3, states.map.2)
```

```{r}
CAAL27.range.5 = st_as_sf(CAAL27.range.4)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(dat = CAAL27.range.5, col = "red", linewidth = 2)+
  geom_point(data = CAAL27.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
CAAL27.range.5$species = "Carya alba"
CAAL27_flag = cc_iucn(x = CAAL27.occ, range = CAAL27.range.5, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
CAAL27_occ_final = CAAL27.occ[CAAL27_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = CAAL27.range.5, col = "red", linewidth = 2)+
  geom_point(data = CAAL27_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/CAAL27.range.pdf", width = 12, height = 8)
```

```{r}
CAAL27.coords = CAAL27_occ_final[c(3,2)]
rangeSize(CAAL27.coords, crs = "epsg:4267")
```

Subset for Carya aquatica

```{r}
CAAQ2.occ = gbif %>%
  filter(species == "Carya aquatica") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
CAAQ2.range = st_read("../../USTreeAtlas/shp/caryaqua/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(CAAQ2.range)  <- 4267 
```

```{r}
CAAQ2_clipped = st_intersection(CAAQ2.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = CAAQ2_clipped, col = "red", linewidth = 2)+
  geom_point(data = CAAQ2.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
CAAQ2_clipped$species = "Carya aquatica"
CAAQ2_flag = cc_iucn(x = CAAQ2.occ, range = CAAQ2_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
CAAQ2_occ_final = CAAQ2.occ[CAAQ2_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = CAAQ2_clipped, col = "red", linewidth = 2)+
  geom_point(data = CAAQ2_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/CAAQ2.range.pdf", width = 12, height = 8)
```

```{r}
CAAQ2.coords = CAAQ2_occ_final[c(3,2)]
rangeSize(CAAQ2.coords, crs = "epsg:4267")
```

Subset for Carya cordiformis

```{r}
CACO15.occ = gbif %>%
  filter(species == "Carya cordiformis") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
CACO15.range = st_read("../../USTreeAtlas/shp/carycord/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(CACO15.range)  <- 4267 
```

```{r}
CACO15_clipped = st_intersection(CACO15.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = CACO15_clipped, col = "red", linewidth = 2)+
  geom_point(data = CACO15.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
CACO15_clipped$species = "Carya cordiformis"
CACO15_flag = cc_iucn(x = CACO15.occ, range = CACO15_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
CACO15_occ_final = CACO15.occ[CACO15_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = CACO15_clipped, col = "red", linewidth = 2)+
  geom_point(data = CACO15_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/CACO15.range.pdf", width = 12, height = 8)
```


```{r}
CACO15.coords = CACO15_occ_final[c(3,2)]
rangeSize(CACO15.coords, crs = "epsg:4267")
```

Subset for Carya glabra

```{r}
CAGL8.occ = gbif %>%
  filter(species == "Carya glabra") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
CAGL8.range = st_read("../../USTreeAtlas/shp/caryglab/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(CAGL8.range)  <- 4267 
```

```{r}
CAGL8_clipped = st_intersection(CAGL8.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = CAGL8_clipped, col = "red", linewidth = 2)+
  geom_point(data = CAGL8.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
CAGL8_clipped$species = "Carya glabra"
CAGL8_flag = cc_iucn(x = CAGL8.occ, range = CAGL8_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
CAGL8_occ_final = CAGL8.occ[CAGL8_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = CAGL8_clipped, col = "red", linewidth = 2)+
  geom_point(data = CAGL8_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/CAGL8.range.pdf", width = 12, height = 8)
```

```{r}
CAGL8.coords = CAGL8_occ_final[c(3,2)]
rangeSize(CAGL8.coords, crs = "epsg:4267")
```

Subset for Carya illinoinensis

```{r}
CAIL2.occ = gbif %>%
  filter(species == "Carya illinoinensis") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
CAIL2.range = st_read("../../USTreeAtlas/shp/caryilli/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(CAIL2.range)  <- 4267 
```

```{r}
CAIL2_clipped = st_intersection(CAIL2.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = CAIL2_clipped, col = "red", linewidth = 2)+
  geom_point(data = CAIL2.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
CAIL2_clipped$species = "Carya illinoinensis"
CAIL2_flag = cc_iucn(x = CAIL2.occ, range = CAIL2_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
CAIL2_occ_final = CAIL2.occ[CAIL2_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = CAIL2_clipped, col = "red", linewidth = 2)+
  geom_point(data = CAIL2_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/CAIL2.range.pdf", width = 12, height = 8)
```

```{r}
CAIL2.coords = CAIL2_occ_final[c(3,2)]
rangeSize(CAIL2.coords, crs = "epsg:4267")
```

Subset for Carya ovata

```{r}
CAOV2.occ = gbif %>%
  filter(species == "Carya ovata") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
CAOV2.range = st_read("../../USTreeAtlas/shp/caryovat/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(CAOV2.range)  <- 4267 
```

```{r}
CAOV2_clipped = st_intersection(CAOV2.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = CAOV2_clipped, col = "red", linewidth = 2)+
  geom_point(data = CAOV2.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
CAOV2_clipped$species = "Carya ovata"
CAOV2_flag = cc_iucn(x = CAOV2.occ, range = CAOV2_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
CAOV2_occ_final = CAOV2.occ[CAOV2_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = CAOV2_clipped, col = "red", linewidth = 2)+
  geom_point(data = CAOV2_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/CAOV2.range.pdf", width = 12, height = 8)
```

```{r}
CAOV2.coords = CAOV2_occ_final[c(3,2)]
rangeSize(CAOV2.coords, crs = "epsg:4267")
```

Subset for Carya texana

```{r}
CATE9.occ = gbif %>%
  filter(species == "Carya texana") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
CATE9.range = st_read("../../USTreeAtlas/shp/carytexa/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(CATE9.range)  <- 4267 
```

```{r}
CATE9_clipped = st_intersection(CATE9.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = CATE9_clipped, col = "red", linewidth = 2)+
  geom_point(data = CATE9.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
CATE9_clipped$species = "Carya texana"
CATE9_flag = cc_iucn(x = CATE9.occ, range = CATE9_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
CATE9_occ_final = CATE9.occ[CATE9_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = CATE9_clipped, col = "red", linewidth = 2)+
  geom_point(data = CATE9_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/CATE9.range.pdf", width = 12, height = 8)
```

```{r}
CATE9.coords = CATE9_occ_final[c(3,2)]
rangeSize(CATE9.coords, crs = "epsg:4267")
```

Subset for Castanea dentata

```{r}
CADE12.occ = gbif %>%
  filter(species == "Castanea dentata") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
CADE12.range = st_read("../../USTreeAtlas/shp/castdent/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(CADE12.range)  <- 4267 
```

```{r}
CADE12_clipped = st_intersection(CADE12.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = CADE12_clipped, col = "red", linewidth = 2)+
  geom_point(data = CADE12.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
CADE12_clipped$species = "Castanea dentata"
CADE12_flag = cc_iucn(x = CADE12.occ, range = CADE12_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
CADE12_occ_final = CADE12.occ[CADE12_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = CADE12_clipped, col = "red", linewidth = 2)+
  geom_point(data = CADE12_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/CADE12.range.pdf", width = 12, height = 8)
```

```{r}
CADE12.coords = CADE12_occ_final[c(3,2)]
rangeSize(CADE12.coords, crs = "epsg:4267")
```

Subset for Celtis laevigata

```{r}
CELA.occ = gbif %>%
  filter(species == "Celtis laevigata") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
CELA.range = st_read("../../USTreeAtlas/shp/celtlaev/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(CELA.range)  <- 4267 
```

```{r}
CELA_clipped = st_intersection(CELA.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = CELA_clipped, col = "red", linewidth = 2)+
  geom_point(data = CELA.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
CELA_clipped$species = "Celtis laevigata"
CELA_flag = cc_iucn(x = CELA.occ, range = CELA_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
CELA_occ_final = CELA.occ[CELA_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = CELA_clipped, col = "red", linewidth = 2)+
  geom_point(data = CELA_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/CELA.range.pdf", width = 12, height = 8)
```

```{r}
CELA.coords = CELA_occ_final[c(3,2)]
rangeSize(CELA.coords, crs = "epsg:4267")
```

Subset for Celtis occidentalis

```{r}
CEOC.occ = gbif %>%
  filter(species == "Celtis occidentalis") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
CEOC.range = st_read("../../USTreeAtlas/shp/celtocci/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(CEOC.range)  <- 4267 
```

```{r}
CEOC_clipped = st_intersection(CEOC.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = CEOC_clipped, col = "red", linewidth = 2)+
  geom_point(data = CEOC.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
CEOC_clipped$species = "Celtis occidentalis"
CEOC_flag = cc_iucn(x = CEOC.occ, range = CEOC_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
CEOC_occ_final = CEOC.occ[CEOC_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = CEOC_clipped, col = "red", linewidth = 2)+
  geom_point(data = CEOC_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/CEOC.range.pdf", width = 12, height = 8)
```

```{r}
CEOC.coords = CEOC_occ_final[c(3,2)]
rangeSize(CEOC.coords, crs = "epsg:4267")
```


Subset for Cercis canadensis. Little range map unavailable

```{r}
CECA4.occ = gbif %>%
  filter(species == "Cercis canadensis") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Get range map from BIEN

```{r}
(CECA4.range.sf <- BIEN_ranges_load_species('Cercis canadensis'))
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The BIEN ranges are WG84.

```{r}
CECA4.range.2 = CECA4.range.sf %>%
  st_transform(st_crs(states.map))
```

```{r}
CECA4.range.3 = terra::vect(CECA4.range.2)
states.map.2 = terra::vect(states.map)
```

```{r}
CECA4.range.4 = terra::intersect(CECA4.range.3, states.map.2)
```

```{r}
CECA4.range.5 = st_as_sf(CECA4.range.4)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(dat = CECA4.range.5, col = "red", linewidth = 2)+
  geom_point(data = CECA4.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
CECA4.range.5$species = "Cercis canadensis"
CECA4_flag = cc_iucn(x = CECA4.occ, range = CECA4.range.5, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
CECA4_occ_final = CECA4.occ[CECA4_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = CECA4.range.5, col = "red", linewidth = 2)+
  geom_point(data = CECA4_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/CECA4.range.pdf", width = 12, height = 8)
```

```{r}
CECA4.coords = CECA4_occ_final[c(3,2)]
rangeSize(CECA4.coords, crs = "epsg:4267")
```

Subset for Chamaecyparis thyoides

```{r}
CHTH2.occ = gbif %>%
  filter(species == "Chamaecyparis thyoides") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
CHTH2.range = st_read("../../USTreeAtlas/shp/chamthyo/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(CHTH2.range)  <- 4267 
```

```{r}
CHTH2_clipped = st_intersection(CHTH2.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = CHTH2_clipped, col = "red", linewidth = 2)+
  geom_point(data = CHTH2.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
CHTH2_clipped$species = "Chamaecyparis thyoides"
CHTH2_flag = cc_iucn(x = CHTH2.occ, range = CHTH2_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
CHTH2_occ_final = CHTH2.occ[CHTH2_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = CHTH2_clipped, col = "red", linewidth = 2)+
  geom_point(data = CHTH2_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/CHTH2.range.pdf", width = 12, height = 8)
```

```{r}
CHTH2.coords = CHTH2_occ_final[c(3,2)]
rangeSize(CHTH2.coords, crs = "epsg:4267")
```

Subset for Cornus florida

```{r}
COFL2.occ = gbif %>%
  filter(species == "Cornus florida") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
COFL2.range = st_read("../../USTreeAtlas/shp/cornflor/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(COFL2.range)  <- 4267 
```

```{r}
COFL2_clipped = st_intersection(COFL2.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = COFL2_clipped, col = "red", linewidth = 2)+
  geom_point(data = COFL2.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
COFL2_clipped$species = "Cornus florida"
COFL2_flag = cc_iucn(x = COFL2.occ, range = COFL2_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
COFL2_occ_final = COFL2.occ[COFL2_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = COFL2_clipped, col = "red", linewidth = 2)+
  geom_point(data = COFL2_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/COFL2.range.pdf", width = 12, height = 8)
```

```{r}
COFL2.coords = COFL2_occ_final[c(3,2)]
rangeSize(COFL2.coords, crs = "epsg:4267")
```

Subset for Diospyros virginiana

```{r}
DIVI5.occ = gbif %>%
  filter(species == "Diospyros virginiana") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
DIVI5.range = st_read("../../USTreeAtlas/shp/diosvirg/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(DIVI5.range)  <- 4267 
```

```{r}
DIVI5_clipped = st_intersection(DIVI5.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = DIVI5_clipped, col = "red", linewidth = 2)+
  geom_point(data = DIVI5.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
DIVI5_clipped$species = "Diospyros virginiana"
DIVI5_flag = cc_iucn(x = DIVI5.occ, range = DIVI5_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
DIVI5_occ_final = DIVI5.occ[DIVI5_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = DIVI5_clipped, col = "red", linewidth = 2)+
  geom_point(data = DIVI5_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/DIVI5.range.pdf", width = 12, height = 8)
```

```{r}
DIVI5.coords = DIVI5_occ_final[c(3,2)]
rangeSize(DIVI5.coords, crs = "epsg:4267")
```


Subset for Fagus grandifolia

```{r}
FAGR.occ = gbif %>%
  filter(species == "Fagus grandifolia") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
FAGR.range = st_read("../../USTreeAtlas/shp/fagugran/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(FAGR.range)  <- 4267 
```

```{r}
FAGR_clipped = st_intersection(FAGR.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = FAGR_clipped, col = "red", linewidth = 2)+
  geom_point(data = FAGR.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
FAGR_clipped$species = "Fagus grandifolia"
FAGR_flag = cc_iucn(x = FAGR.occ, range = FAGR_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
FAGR_occ_final = FAGR.occ[FAGR_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = FAGR_clipped, col = "red", linewidth = 2)+
  geom_point(data = FAGR_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/FAGR.range.pdf", width = 12, height = 8)
```

```{r}
FAGR.coords = FAGR_occ_final[c(3,2)]
rangeSize(FAGR.coords, crs = "epsg:4267")
```

Subset for Fraxinus americana

```{r}
FRAM2.occ = gbif %>%
  filter(species == "Fraxinus americana") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
FRAM2.range = st_read("../../USTreeAtlas/shp/fraxamer/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(FRAM2.range)  <- 4267 
```

```{r}
FRAM2_clipped = st_intersection(FRAM2.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = FRAM2_clipped, col = "red", linewidth = 2)+
  geom_point(data = FRAM2.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
FRAM2_clipped$species = "Fraxinus americana"
FRAM2_flag = cc_iucn(x = FRAM2.occ, range = FRAM2_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
FRAM2_occ_final = FRAM2.occ[FRAM2_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = FRAM2_clipped, col = "red", linewidth = 2)+
  geom_point(data = FRAM2_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/FRAM2.range.pdf", width = 12, height = 8)
```

```{r}
FRAM2.coords = FRAM2_occ_final[c(3,2)]
rangeSize(FRAM2.coords, crs = "epsg:4267")
```


Subset for Fraxinus caroliniana

```{r}
FRCA3.occ = gbif %>%
  filter(species == "Fraxinus caroliniana") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
FRCA3.range = st_read("../../USTreeAtlas/shp/fraxcaro/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(FRCA3.range)  <- 4267 
```

```{r}
FRCA3_clipped = st_intersection(FRCA3.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = FRCA3_clipped, col = "red", linewidth = 2)+
  geom_point(data = FRCA3.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
FRCA3_clipped$species = "Fraxinus caroliniana"
FRCA3_flag = cc_iucn(x = FRCA3.occ, range = FRCA3_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
FRCA3_occ_final = FRCA3.occ[FRCA3_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = FRCA3_clipped, col = "red", linewidth = 2)+
  geom_point(data = FRCA3_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/FRCA3.range.pdf", width = 12, height = 8)
```

```{r}
FRCA3.coords = FRCA3_occ_final[c(3,2)]
rangeSize(FRCA3.coords, crs = "epsg:4267")
```

Subset for Fraxinus nigra

```{r}
FRNI.occ = gbif %>%
  filter(species == "Fraxinus nigra") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
FRNI.range = st_read("../../USTreeAtlas/shp/fraxnigr/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(FRNI.range)  <- 4267 
```

```{r}
FRNI_clipped = st_intersection(FRNI.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = FRNI_clipped, col = "red", linewidth = 2)+
  geom_point(data = FRNI.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
FRNI_clipped$species = "Fraxinus nigra"
FRNI_flag = cc_iucn(x = FRNI.occ, range = FRNI_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
FRNI_occ_final = FRNI.occ[FRNI_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = FRNI_clipped, col = "red", linewidth = 2)+
  geom_point(data = FRNI_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/FRNI.range.pdf", width = 12, height = 8)
```

```{r}
FRNI.coords = FRNI_occ_final[c(3,2)]
rangeSize(FRNI.coords, crs = "epsg:4267")
```

Subset for Fraxinus pennsylvanica

```{r}
FRPE.occ = gbif %>%
  filter(species == "Fraxinus pennsylvanica") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
FRPE.range = st_read("../../USTreeAtlas/shp/fraxpenn/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(FRPE.range)  <- 4267 
```

```{r}
FRPE_clipped = st_intersection(FRPE.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = FRPE_clipped, col = "red", linewidth = 2)+
  geom_point(data = FRPE.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
FRPE_clipped$species = "Fraxinus pennsylvanica"
FRPE_flag = cc_iucn(x = FRPE.occ, range = FRPE_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
FRPE_occ_final = FRPE.occ[FRPE_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = FRPE_clipped, col = "red", linewidth = 2)+
  geom_point(data = FRPE_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/FRPE.range.pdf", width = 12, height = 8)
```

```{r}
FRPE.coords = FRPE_occ_final[c(3,2)]
rangeSize(FRPE.coords, crs = "epsg:4267")
```

Subset for Fraxinus profunda

```{r}
FRPR.occ = gbif %>%
  filter(species == "Fraxinus profunda") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
FRPR.range = st_read("../../USTreeAtlas/shp/fraxprof/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(FRPR.range)  <- 4267 
```

```{r}
FRPR_clipped = st_intersection(FRPR.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = FRPR_clipped, col = "red", linewidth = 2)+
  geom_point(data = FRPR.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
FRPR_clipped$species = "Fraxinus profunda"
FRPR_flag = cc_iucn(x = FRPR.occ, range = FRPR_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
FRPR_occ_final = FRPR.occ[FRPR_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = FRPR_clipped, col = "red", linewidth = 2)+
  geom_point(data = FRPR_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/FRPR.range.pdf", width = 12, height = 8)
```

```{r}
FRPR.coords = FRPR_occ_final[c(3,2)]
rangeSize(FRPR.coords, crs = "epsg:4267")
```

Subset for Fraxinus quadrangulata

```{r}
FRQU.occ = gbif %>%
  filter(species == "Fraxinus quadrangulata") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
FRQU.range = st_read("../../USTreeAtlas/shp/fraxquad/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(FRQU.range)  <- 4267 
```

```{r}
FRQU_clipped = st_intersection(FRQU.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = FRQU_clipped, col = "red", linewidth = 2)+
  geom_point(data = FRQU.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
FRQU_clipped$species = "Fraxinus quadrangulata"
FRQU_flag = cc_iucn(x = FRQU.occ, range = FRQU_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
FRQU_occ_final = FRQU.occ[FRQU_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = FRQU_clipped, col = "red", linewidth = 2)+
  geom_point(data = FRQU_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/FRQU.range.pdf", width = 12, height = 8)
```

```{r}
FRQU.coords = FRQU_occ_final[c(3,2)]
rangeSize(FRQU.coords, crs = "epsg:4267")
```


Subset for Fraxinus texensis/Fraxinus albicans (gbif)

```{r}
FRTE.occ = gbif %>%
  filter(species == "Fraxinus albicans") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
FRTE.range = st_read("../../USTreeAtlas/shp/fraxtexe/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(FRTE.range)  <- 4267 
```

```{r}
FRTE_clipped = st_intersection(FRTE.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = FRTE_clipped, col = "red", linewidth = 2)+
  geom_point(data = FRTE.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
FRTE_clipped$species = "Fraxinus albicans"
FRTE_flag = cc_iucn(x = FRTE.occ, range = FRTE_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
FRTE_occ_final = FRTE.occ[FRTE_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = FRTE_clipped, col = "red", linewidth = 2)+
  geom_point(data = FRTE_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/FRTE.range.pdf", width = 12, height = 8)
```

```{r}
FRTE.coords = FRTE_occ_final[c(3,2)]
rangeSize(FRTE.coords, crs = "epsg:4267")
```

Subset for Gleditsia aquatica

```{r}
GLAQ.occ = gbif %>%
  filter(species == "Gleditsia aquatica") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
GLAQ.range = st_read("../../USTreeAtlas/shp/gledaqua/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(GLAQ.range)  <- 4267 
```

```{r}
GLAQ_clipped = st_intersection(GLAQ.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = GLAQ_clipped, col = "red", linewidth = 2)+
  geom_point(data = GLAQ.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
GLAQ_clipped$species = "Gleditsia aquatica"
GLAQ_flag = cc_iucn(x = GLAQ.occ, range = GLAQ_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
GLAQ_occ_final = GLAQ.occ[GLAQ_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = GLAQ_clipped, col = "red", linewidth = 2)+
  geom_point(data = GLAQ_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/GLAQ.range.pdf", width = 12, height = 8)
```

```{r}
GLAQ.coords = GLAQ_occ_final[c(3,2)]
rangeSize(GLAQ.coords, crs = "epsg:4267")
```

Subset for Gleditsia triacanthos

```{r}
GLTR.occ = gbif %>%
  filter(species == "Gleditsia triacanthos") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
GLTR.range = st_read("../../USTreeAtlas/shp/gledtria/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(GLTR.range)  <- 4267 
```

```{r}
GLTR_clipped = st_intersection(GLTR.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = GLTR_clipped, col = "red", linewidth = 2)+
  geom_point(data = GLTR.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
GLTR_clipped$species = "Gleditsia triacanthos"
GLTR_flag = cc_iucn(x = GLTR.occ, range = GLTR_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
GLTR_occ_final = GLTR.occ[GLTR_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = GLTR_clipped, col = "red", linewidth = 2)+
  geom_point(data = GLTR_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/GLTR.range.pdf", width = 12, height = 8)
```

```{r}
GLTR.coords = GLTR_occ_final[c(3,2)]
rangeSize(GLTR.coords, crs = "epsg:4267")
```

Subset for Gordonia lasianthus

```{r}
GOLA.occ = gbif %>%
  filter(species == "Gordonia lasianthus") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
GOLA.range = st_read("../../USTreeAtlas/shp/gordlasi/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(GOLA.range)  <- 4267 
```

```{r}
GOLA_clipped = st_intersection(GOLA.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = GOLA_clipped, col = "red", linewidth = 2)+
  geom_point(data = GOLA.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
GOLA_clipped$species = "Gordonia lasianthus"
GOLA_flag = cc_iucn(x = GOLA.occ, range = GOLA_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
GOLA_occ_final = GOLA.occ[GOLA_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = GOLA_clipped, col = "red", linewidth = 2)+
  geom_point(data = GOLA_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/GOLA.range.pdf", width = 12, height = 8)
```

```{r}
GOLA.coords = GOLA_occ_final[c(3,2)]
rangeSize(GOLA.coords, crs = "epsg:4267")
```

Subset for Gymnocladus dioicus

```{r}
GYDI.occ = gbif %>%
  filter(species == "Gymnocladus dioicus") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
GYDI.range = st_read("../../USTreeAtlas/shp/gymndioi/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(GYDI.range)  <- 4267 
```

```{r}
GYDI_clipped = st_intersection(GYDI.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = GYDI_clipped, col = "red", linewidth = 2)+
  geom_point(data = GYDI.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
GYDI_clipped$species = "Gymnocladus dioicus"
GYDI_flag = cc_iucn(x = GYDI.occ, range = GYDI_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
GYDI_occ_final = GYDI.occ[GYDI_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = GYDI_clipped, col = "red", linewidth = 2)+
  geom_point(data = GYDI_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/GYDI.range.pdf", width = 12, height = 8)
```

```{r}
GYDI.coords = GYDI_occ_final[c(3,2)]
rangeSize(GYDI.coords, crs = "epsg:4267")
```

Subset for Ilex opaca

```{r}
ILOP.occ = gbif %>%
  filter(species == "Ilex opaca") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
ILOP.range = st_read("../../USTreeAtlas/shp/ilexopac/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(ILOP.range)  <- 4267 
```

```{r}
ILOP_clipped = st_intersection(ILOP.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = ILOP_clipped, col = "red", linewidth = 2)+
  geom_point(data = ILOP.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
ILOP_clipped$species = "Ilex opaca"
ILOP_flag = cc_iucn(x = ILOP.occ, range = ILOP_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
ILOP_occ_final = ILOP.occ[ILOP_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = ILOP_clipped, col = "red", linewidth = 2)+
  geom_point(data = ILOP_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/ILOP.range.pdf", width = 12, height = 8)
```

```{r}
ILOP.coords = ILOP_occ_final[c(3,2)]
rangeSize(ILOP.coords, crs = "epsg:4267")
```

Subset for Juglans cinerea

```{r}
JUCI.occ = gbif %>%
  filter(species == "Juglans cinerea") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
JUCI.range = st_read("../../USTreeAtlas/shp/juglcine/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(JUCI.range)  <- 4267 
```

```{r}
JUCI_clipped = st_intersection(JUCI.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = JUCI_clipped, col = "red", linewidth = 2)+
  geom_point(data = JUCI.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
JUCI_clipped$species = "Juglans cinerea"
JUCI_flag = cc_iucn(x = JUCI.occ, range = JUCI_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
JUCI_occ_final = JUCI.occ[JUCI_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = JUCI_clipped, col = "red", linewidth = 2)+
  geom_point(data = JUCI_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/JUCI.range.pdf", width = 12, height = 8)
```

```{r}
JUCI.coords = JUCI_occ_final[c(3,2)]
rangeSize(JUCI.coords, crs = "epsg:4267")
```

Subset for Juglans nigra

```{r}
JUNI.occ = gbif %>%
  filter(species == "Juglans nigra") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
JUNI.range = st_read("../../USTreeAtlas/shp/juglnigr/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(JUNI.range)  <- 4267 
```

```{r}
JUNI_clipped = st_intersection(JUNI.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = JUNI_clipped, col = "red", linewidth = 2)+
  geom_point(data = JUNI.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
JUNI_clipped$species = "Juglans nigra"
JUNI_flag = cc_iucn(x = JUNI.occ, range = JUNI_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
JUNI_occ_final = JUNI.occ[JUNI_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = JUNI_clipped, col = "red", linewidth = 2)+
  geom_point(data = JUNI_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/JUNI.range.pdf", width = 12, height = 8)
```

```{r}
JUNI.coords = JUNI_occ_final[c(3,2)]
rangeSize(JUNI.coords, crs = "epsg:4267")
```

Subset for Juniperus virginiana

```{r}
JUVI.occ = gbif %>%
  filter(species == "Juniperus virginiana") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
JUVI.range = st_read("../../USTreeAtlas/shp/junivirg/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(JUVI.range)  <- 4267 
```

```{r}
JUVI_clipped = st_intersection(JUVI.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = JUVI_clipped, col = "red", linewidth = 2)+
  geom_point(data = JUVI.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
JUVI_clipped$species = "Juniperus virginiana"
JUVI_flag = cc_iucn(x = JUVI.occ, range = JUVI_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
JUVI_occ_final = JUVI.occ[JUVI_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = JUVI_clipped, col = "red", linewidth = 2)+
  geom_point(data = JUVI_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/JUVI.range.pdf", width = 12, height = 8)
```

```{r}
JUNV.coords = JUVI_occ_final[c(3,2)]
rangeSize(JUVI.coords, crs = "epsg:4267")
```

Subset for Larix laricina

```{r}
LALA.occ = gbif %>%
  filter(species == "Larix laricina") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
LALA.range = st_read("../../USTreeAtlas/shp/larilari/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(LALA.range)  <- 4267 
```

```{r}
LALA_clipped = st_intersection(LALA.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = LALA_clipped, col = "red", linewidth = 2)+
  geom_point(data = LALA.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
LALA_clipped$species = "Larix laricina"
LALA_flag = cc_iucn(x = LALA.occ, range = LALA_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
LALA_occ_final = LALA.occ[LALA_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = LALA_clipped, col = "red", linewidth = 2)+
  geom_point(data = LALA_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/LALA.range.pdf", width = 12, height = 8)
```

```{r}
LALA.coords = LALA_occ_final[c(3,2)]
rangeSize(LALA.coords, crs = "epsg:4267")
```

Subset for Liquidambar styraciflua

```{r}
LIST2.occ = gbif %>%
  filter(species == "Liquidambar styraciflua") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
LIST2.range = st_read("../../USTreeAtlas/shp/liqustyr/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(LIST2.range)  <- 4267 
```

```{r}
LIST2_clipped = st_intersection(LIST2.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = LIST2_clipped, col = "red", linewidth = 2)+
  geom_point(data = LIST2.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
LIST2_clipped$species = "Liquidambar styraciflua"
LIST2_flag = cc_iucn(x = LIST2.occ, range = LIST2_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
LIST2_occ_final = LIST2.occ[LIST2_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = LIST2_clipped, col = "red", linewidth = 2)+
  geom_point(data = LIST2_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/LIST2.range.pdf", width = 12, height = 8)
```

```{r}
LIST2.coords = LIST2_occ_final[c(3,2)]
rangeSize(LIST2.coords, crs = "epsg:4267")
```

Subset for Liriodendron tulipifera

```{r}
LITU.occ = gbif %>%
  filter(species == "Liriodendron tulipifera") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
LITU.range = st_read("../../USTreeAtlas/shp/lirituli/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(LITU.range)  <- 4267 
```

```{r}
LITU_clipped = st_intersection(LITU.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = LITU_clipped, col = "red", linewidth = 2)+
  geom_point(data = LITU.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
LITU_clipped$species = "Liriodendron tulipifera"
LITU_flag = cc_iucn(x = LITU.occ, range = LITU_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
LITU_occ_final = LITU.occ[LITU_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = LITU_clipped, col = "red", linewidth = 2)+
  geom_point(data = LITU_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/LITU.range.pdf", width = 12, height = 8)
```

```{r}
LITU.coords = LITU_occ_final[c(3,2)]
rangeSize(LITU.coords, crs = "epsg:4267")
```

Subset for Maclura pomifera

```{r}
MAPO.occ = gbif %>%
  filter(species == "Maclura pomifera") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
MAPO.range = st_read("../../USTreeAtlas/shp/maclpomi/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(MAPO.range)  <- 4267 
```

```{r}
MAPO_clipped = st_intersection(MAPO.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = MAPO_clipped, col = "red", linewidth = 2)+
  geom_point(data = MAPO.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
MAPO_clipped$species = "Maclura pomifera"
MAPO_flag = cc_iucn(x = MAPO.occ, range = MAPO_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
MAPO_occ_final = MAPO.occ[MAPO_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = MAPO_clipped, col = "red", linewidth = 2)+
  geom_point(data = MAPO_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/MAPO.range.pdf", width = 12, height = 8)
```

```{r}
MAPO.coords = MAPO_occ_final[c(3,2)]
rangeSize(MAPO.coords, crs = "epsg:4267")
```

Subset for Magnolia acuminata

```{r}
MAAC.occ = gbif %>%
  filter(species == "Magnolia acuminata") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
MAAC.range = st_read("../../USTreeAtlas/shp/magnacum/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(MAAC.range)  <- 4267 
```

```{r}
MAAC_clipped = st_intersection(MAAC.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = MAAC_clipped, col = "red", linewidth = 2)+
  geom_point(data = MAAC.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
MAAC_clipped$species = "Magnolia acuminata"
MAAC_flag = cc_iucn(x = MAAC.occ, range = MAAC_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
MAAC_occ_final = MAAC.occ[MAAC_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = MAAC_clipped, col = "red", linewidth = 2)+
  geom_point(data = MAAC_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/MAAC.range.pdf", width = 12, height = 8)
```

```{r}
MAAC.coords = MAAC_occ_final[c(3,2)]
rangeSize(MAAC.coords, crs = "epsg:4267")
```

Subset for Magnolia fraseri

```{r}
MAFR.occ = gbif %>%
  filter(species == "Magnolia fraseri") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
MAFR.range = st_read("../../USTreeAtlas/shp/magnfras/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(MAFR.range)  <- 4267 
```

```{r}
MAFR_clipped = st_intersection(MAFR.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = MAFR_clipped, col = "red", linewidth = 2)+
  geom_point(data = MAFR.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
MAFR_clipped$species = "Magnolia fraseri"
MAFR_flag = cc_iucn(x = MAFR.occ, range = MAFR_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
MAFR_occ_final = MAFR.occ[MAFR_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = MAFR_clipped, col = "red", linewidth = 2)+
  geom_point(data = MAFR_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/MAFR.range.pdf", width = 12, height = 8)
```

```{r}
MAFR.coords = MAFR_occ_final[c(3,2)]
rangeSize(MAFR.coords, crs = "epsg:4267")
```

Subset for Magnolia grandiflora

```{r}
MAGR4.occ = gbif %>%
  filter(species == "Magnolia grandiflora") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
MAGR4.range = st_read("../../USTreeAtlas/shp/magngran/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(MAGR4.range)  <- 4267 
```

```{r}
MAGR4_clipped = st_intersection(MAGR4.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = MAGR4_clipped, col = "red", linewidth = 2)+
  geom_point(data = MAGR4.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
MAGR4_clipped$species = "Magnolia grandiflora"
MAGR4_flag = cc_iucn(x = MAGR4.occ, range = MAGR4_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
MAGR4_occ_final = MAGR4.occ[MAGR4_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = MAGR4_clipped, col = "red", linewidth = 2)+
  geom_point(data = MAGR4_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/MAGR4.range.pdf", width = 12, height = 8)
```

```{r}
MAGR4.coords = MAGR4_occ_final[c(3,2)]
rangeSize(MAGR4.coords, crs = "epsg:4267")
```


Subset for Magnolia macrophylla

```{r}
MAMA2.occ = gbif %>%
  filter(species == "Magnolia macrophylla") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
MAMA2.range = st_read("../../USTreeAtlas/shp/magnmacr/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(MAMA2.range)  <- 4267 
```

```{r}
MAMA2_clipped = st_intersection(MAMA2.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = MAMA2_clipped, col = "red", linewidth = 2)+
  geom_point(data = MAMA2.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
MAMA2_clipped$species = "Magnolia macrophylla"
MAMA2_flag = cc_iucn(x = MAMA2.occ, range = MAMA2_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
MAMA2_occ_final = MAMA2.occ[MAMA2_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = MAMA2_clipped, col = "red", linewidth = 2)+
  geom_point(data = MAMA2_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/MAMA2.range.pdf", width = 12, height = 8)
```

```{r}
MAMA2.coords = MAMA2_occ_final[c(3,2)]
rangeSize(MAMA2.coords, crs = "epsg:4267")
```

Subset for Magnolia virginiana

```{r}
MAVI2.occ = gbif %>%
  filter(species == "Magnolia virginiana") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
MAVI2.range = st_read("../../USTreeAtlas/shp/magnvirg/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(MAVI2.range)  <- 4267 
```

```{r}
MAVI2_clipped = st_intersection(MAVI2.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = MAVI2_clipped, col = "red", linewidth = 2)+
  geom_point(data = MAVI2.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
MAVI2_clipped$species = "Magnolia virginiana"
MAVI2_flag = cc_iucn(x = MAVI2.occ, range = MAVI2_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
MAVI2_occ_final = MAVI2.occ[MAVI2_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = MAVI2_clipped, col = "red", linewidth = 2)+
  geom_point(data = MAVI2_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/MAVI2.range.pdf", width = 12, height = 8)
```

```{r}
MAVI2.coords = MAVI2_occ_final[c(3,2)]
rangeSize(MAVI2.coords, crs = "epsg:4267")
```


Subset for Morus rubra

```{r}
MORU2.occ = gbif %>%
  filter(species == "Morus rubra") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
MORU2.range = st_read("../../USTreeAtlas/shp/morurubr/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(MORU2.range)  <- 4267 
```

```{r}
MORU2_clipped = st_intersection(MORU2.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = MORU2_clipped, col = "red", linewidth = 2)+
  geom_point(data = MORU2.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
MORU2_clipped$species = "Morus rubra"
MORU2_flag = cc_iucn(x = MORU2.occ, range = MORU2_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
MORU2_occ_final = MORU2.occ[MORU2_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = MORU2_clipped, col = "red", linewidth = 2)+
  geom_point(data = MORU2_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/MORU2.range.pdf", width = 12, height = 8)
```

```{r}
MORU2.coords = MORU2_occ_final[c(3,2)]
rangeSize(MORU2.coords, crs = "epsg:4267")
```

Subset for Nyssa aquatica

```{r}
NYAQ2.occ = gbif %>%
  filter(species == "Nyssa aquatica") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
NYAQ2.range = st_read("../../USTreeAtlas/shp/nyssaqua/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(NYAQ2.range)  <- 4267 
```

```{r}
NYAQ2_clipped = st_intersection(NYAQ2.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = NYAQ2_clipped, col = "red", linewidth = 2)+
  geom_point(data = NYAQ2.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
NYAQ2_clipped$species = "Nyssa aquatica"
NYAQ2_flag = cc_iucn(x = NYAQ2.occ, range = NYAQ2_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
NYAQ2_occ_final = NYAQ2.occ[NYAQ2_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = NYAQ2_clipped, col = "red", linewidth = 2)+
  geom_point(data = NYAQ2_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/NYAQ2.range.pdf", width = 12, height = 8)
```

```{r}
NYAQ2.coords = NYAQ2_occ_final[c(3,2)]
rangeSize(NYAQ2.coords, crs = "epsg:4267")
```

Subset for Nyssa biflora. Little range map not available. BIEN range map not available.

```{r}
NYBI.occ = gbif %>%
  filter(species == "Nyssa biflora") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```


```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_point(data = NYBI.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/NYBI.range.pdf", width = 12, height = 8)
```

Subset for Nyssa ogeche

```{r}
NYOG.occ = gbif %>%
  filter(species == "Nyssa ogeche") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
NYOG.range = st_read("../../USTreeAtlas/shp/nyssogec/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(NYOG.range)  <- 4267 
```

```{r}
NYOG_clipped = st_intersection(NYOG.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = NYOG_clipped, col = "red", linewidth = 2)+
  geom_point(data = NYOG.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
NYOG_clipped$species = "Nyssa ogeche"
NYOG_flag = cc_iucn(x = NYOG.occ, range = NYOG_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
NYOG_occ_final = NYOG.occ[NYOG_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = NYOG_clipped, col = "red", linewidth = 2)+
  geom_point(data = NYOG_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/NYOG.range.pdf", width = 12, height = 8)
```

```{r}
NYOG.coords = NYOG_occ_final[c(3,2)]
rangeSize(NYOG.coords, crs = "epsg:4267")
```

Subset for Nyssa sylvatica

```{r}
NYSY.occ = gbif %>%
  filter(species == "Nyssa sylvatica") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
NYSY.range = st_read("../../USTreeAtlas/shp/nysssylv/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(NYSY.range)  <- 4267 
```

```{r}
NYSY_clipped = st_intersection(NYSY.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = NYSY_clipped, col = "red", linewidth = 2)+
  geom_point(data = NYSY.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
NYSY_clipped$species = "Nyssa sylvatica"
NYSY_flag = cc_iucn(x = NYSY.occ, range = NYSY_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
NYSY_occ_final = NYSY.occ[NYSY_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = NYSY_clipped, col = "red", linewidth = 2)+
  geom_point(data = NYSY_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/NYSY.range.pdf", width = 12, height = 8)
```

```{r}
NYSY.coords = NYSY_occ_final[c(3,2)]
rangeSize(NYSY.coords, crs = "epsg:4267")
```

Subset for Ostrya virginiana

```{r}
OSVI.occ = gbif %>%
  filter(species == "Ostrya virginiana") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
OSVI.range = st_read("../../USTreeAtlas/shp/ostrvirg/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(OSVI.range)  <- 4267 
```

```{r}
OSVI_clipped = st_intersection(OSVI.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = OSVI_clipped, col = "red", linewidth = 2)+
  geom_point(data = OSVI.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
OSVI_clipped$species = "Ostrya virginiana"
OSVI_flag = cc_iucn(x = OSVI.occ, range = OSVI_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
OSVI_occ_final = OSVI.occ[OSVI_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = OSVI_clipped, col = "red", linewidth = 2)+
  geom_point(data = OSVI_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/OSVI.range.pdf", width = 12, height = 8)
```

```{r}
OSVI.coords = OSVI_occ_final[c(3,2)]
rangeSize(OSVI.coords, crs = "epsg:4267")
```

Subset for Oxydendrum arboreum

```{r}
OXAR.occ = gbif %>%
  filter(species == "Oxydendrum arboreum") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
OXAR.range = st_read("../../USTreeAtlas/shp/oxydarbo/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(OXAR.range)  <- 4267 
```

```{r}
OXAR_clipped = st_intersection(OXAR.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = OXAR_clipped, col = "red", linewidth = 2)+
  geom_point(data = OXAR.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
OXAR_clipped$species = "Oxydendrum arboreum"
OXAR_flag = cc_iucn(x = OXAR.occ, range = OXAR_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
OXAR_occ_final = OXAR.occ[OXAR_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = OXAR_clipped, col = "red", linewidth = 2)+
  geom_point(data = OXAR_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/OXAR.range.pdf", width = 12, height = 8)
```

```{r}
OXAR.coords = OXAR_occ_final[c(3,2)]
rangeSize(OXAR.coords, crs = "epsg:4267")
```


Subset for Paulownia tomentosa. Little range map not available.

```{r}
PATO2.occ = gbif %>%
  filter(species == "Paulownia tomentosa") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Get range map from BIEN

```{r}
(PATO2.range.sf <- BIEN_ranges_load_species('Paulownia tomentosa'))
```
The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The BIEN ranges are WG84.

```{r}
PATO2.range.2 = PATO2.range.sf %>%
  st_transform(st_crs(states.map))
```

```{r}
PATO2.range.3 = terra::vect(PATO2.range.2)
states.map.2 = terra::vect(states.map)
```

```{r}
PATO2.range.4 = terra::intersect(PATO2.range.3, states.map.2)
```

```{r}
PATO2.range.5 = st_as_sf(PATO2.range.4)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(dat = PATO2.range.5, col = "red", linewidth = 2)+
  geom_point(data = PATO2.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
PATO2.range.5$species = "Paulownia tomentosa"
PATO2_flag = cc_iucn(x = PATO2.occ, range = PATO2.range.5, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
PATO2_occ_final = PATO2.occ[PATO2_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = PATO2.range.5, col = "red", linewidth = 2)+
  geom_point(data = PATO2_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/PATO2.range.pdf", width = 12, height = 8)
```

```{r}
PATO2.coords = PATO2_occ_final[c(3,2)]
rangeSize(PATO2.coords, crs = "epsg:4267")
```

Subset for Persea borbonia

```{r}
PEBO.occ = gbif %>%
  filter(species == "Persea borbonia") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
PEBO.range = st_read("../../USTreeAtlas/shp/persborb/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(PEBO.range)  <- 4267 
```

```{r}
PEBO_clipped = st_intersection(PEBO.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = PEBO_clipped, col = "red", linewidth = 2)+
  geom_point(data = PEBO.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
PEBO_clipped$species = "Persea borbonia"
PEBO_flag = cc_iucn(x = PEBO.occ, range = PEBO_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
PEBO_occ_final = PEBO.occ[PEBO_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = PEBO_clipped, col = "red", linewidth = 2)+
  geom_point(data = PEBO_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/PEBO.range.pdf", width = 12, height = 8)
```

```{r}
PEBO.coords = PEBO_occ_final[c(3,2)]
rangeSize(PEBO.coords, crs = "epsg:4267")
```

Subset for Picea glauca

```{r}
PIGL.occ = gbif %>%
  filter(species == "Picea glauca") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
PIGL.range = st_read("../../USTreeAtlas/shp/piceglau/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(PIGL.range)  <- 4267 
```

```{r}
PIGL_clipped = st_intersection(PIGL.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = PIGL_clipped, col = "red", linewidth = 2)+
  geom_point(data = PIGL.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
PIGL_clipped$species = "Picea glauca"
PIGL_flag = cc_iucn(x = PIGL.occ, range = PIGL_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
PIGL_occ_final = PIGL.occ[PIGL_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = PIGL_clipped, col = "red", linewidth = 2)+
  geom_point(data = PIGL_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/PIGL.range.pdf", width = 12, height = 8)
```

```{r}
PIGL.coords = PIGL_occ_final[c(3,2)]
rangeSize(PIGL.coords, crs = "epsg:4267")
```

Subset for Picea mariana

```{r}
PIMA.occ = gbif %>%
  filter(species == "Picea mariana") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
PIMA.range = st_read("../../USTreeAtlas/shp/picemari/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(PIMA.range)  <- 4267 
```

```{r}
PIMA_clipped = st_intersection(PIMA.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = PIMA_clipped, col = "red", linewidth = 2)+
  geom_point(data = PIMA.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
PIMA_clipped$species = "Picea mariana"
PIMA_flag = cc_iucn(x = PIMA.occ, range = PIMA_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
PIMA_occ_final = PIMA.occ[PIMA_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = PIMA_clipped, col = "red", linewidth = 2)+
  geom_point(data = PIMA_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/PIMA.range.pdf", width = 12, height = 8)
```

```{r}
PIMA.coords = PIMA_occ_final[c(3,2)]
rangeSize(PIMA.coords, crs = "epsg:4267")
```

Subset for Picea rubens

```{r}
PIRU.occ = gbif %>%
  filter(species == "Picea rubens") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
PIRU.range = st_read("../../USTreeAtlas/shp/picerube/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(PIRU.range)  <- 4267 
```

```{r}
PIRU_clipped = st_intersection(PIRU.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = PIRU_clipped, col = "red", linewidth = 2)+
  geom_point(data = PIRU.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
PIRU_clipped$species = "Picea rubens"
PIRU_flag = cc_iucn(x = PIRU.occ, range = PIRU_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
PIRU_occ_final = PIRU.occ[PIRU_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = PIRU_clipped, col = "red", linewidth = 2)+
  geom_point(data = PIRU_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/PIRU.range.pdf", width = 12, height = 8)
```

```{r}
PIRU.coords = PIRU_occ_final[c(3,2)]
rangeSize(PIRU.coords, crs = "epsg:4267")
```

Subset for Pinus banksiana

```{r}
PIBA2.occ = gbif %>%
  filter(species == "Pinus banksiana") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
PIBA2.range = st_read("../../USTreeAtlas/shp/pinubank/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(PIBA2.range)  <- 4267 
```

```{r}
PIBA2_clipped = st_intersection(PIBA2.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = PIBA2_clipped, col = "red", linewidth = 2)+
  geom_point(data = PIBA2.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
PIBA2_clipped$species = "Pinus banksiana"
PIBA2_flag = cc_iucn(x = PIBA2.occ, range = PIBA2_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
PIBA2_occ_final = PIBA2.occ[PIBA2_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = PIBA2_clipped, col = "red", linewidth = 2)+
  geom_point(data = PIBA2_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/PIBA2.range.pdf", width = 12, height = 8)
```

```{r}
PIBA2.coords = PIBA2_occ_final[c(3,2)]
rangeSize(PIBA2.coords, crs = "epsg:4267")
```

Subset for Pinus clausa

```{r}
PICL.occ = gbif %>%
  filter(species == "Pinus clausa") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
PICL.range = st_read("../../USTreeAtlas/shp/pinuclau/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(PICL.range)  <- 4267 
```

```{r}
PICL_clipped = st_intersection(PICL.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = PICL_clipped, col = "red", linewidth = 2)+
  geom_point(data = PICL.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
PICL_clipped$species = "Pinus clausa"
PICL_flag = cc_iucn(x = PICL.occ, range = PICL_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
PICL_occ_final = PICL.occ[PICL_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = PICL_clipped, col = "red", linewidth = 2)+
  geom_point(data = PICL_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/PICL.range.pdf", width = 12, height = 8)
```

```{r}
PICL.coords = PICL_occ_final[c(3,2)]
rangeSize(PICL.coords, crs = "epsg:4267")
```


Subset for Pinus echinata

```{r}
PIEC2.occ = gbif %>%
  filter(species == "Pinus echinata") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
PIEC2.range = st_read("../../USTreeAtlas/shp/pinuechi/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(PIEC2.range)  <- 4267 
```

```{r}
PIEC2_clipped = st_intersection(PIEC2.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = PIEC2_clipped, col = "red", linewidth = 2)+
  geom_point(data = PIEC2.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
PIEC2_clipped$species = "Pinus echinata"
PIEC2_flag = cc_iucn(x = PIEC2.occ, range = PIEC2_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
PIEC2_occ_final = PIEC2.occ[PIEC2_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = PIEC2_clipped, col = "red", linewidth = 2)+
  geom_point(data = PIEC2_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/PIEC2.range.pdf", width = 12, height = 8)
```

```{r}
PIEC2.coords = PIEC2_occ_final[c(3,2)]
rangeSize(PIEC2.coords, crs = "epsg:4267")
```

Subset for Pinus elliottii

```{r}
PIEL.occ = gbif %>%
  filter(species == "Pinus elliottii") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
PIEL.range = st_read("../../USTreeAtlas/shp/pinuelli/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(PIEL.range)  <- 4267 
```

```{r}
PIEL_clipped = st_intersection(PIEL.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = PIEL_clipped, col = "red", linewidth = 2)+
  geom_point(data = PIEL.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
PIEL_clipped$species = "Pinus elliottii"
PIEL_flag = cc_iucn(x = PIEL.occ, range = PIEL_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
PIEL_occ_final = PIEL.occ[PIEL_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = PIEL_clipped, col = "red", linewidth = 2)+
  geom_point(data = PIEL_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/PIEL.range.pdf", width = 12, height = 8)
```

```{r}
PIEL.coords = PIEL_occ_final[c(3,2)]
rangeSize(PIEL.coords, crs = "epsg:4267")
```

Subset for Pinus glabra

```{r}
PIGL2.occ = gbif %>%
  filter(species == "Pinus glabra") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
PIGL2.range = st_read("../../USTreeAtlas/shp/pinuglab/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(PIGL2.range)  <- 4267 
```

```{r}
PIGL2_clipped = st_intersection(PIGL2.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = PIGL2_clipped, col = "red", linewidth = 2)+
  geom_point(data = PIGL2.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
PIGL2_clipped$species = "Pinus glabra"
PIGL2_flag = cc_iucn(x = PIGL2.occ, range = PIGL2_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
PIGL2_occ_final = PIGL2.occ[PIGL2_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = PIGL2_clipped, col = "red", linewidth = 2)+
  geom_point(data = PIGL2_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/PIGL2.range.pdf", width = 12, height = 8)
```

```{r}
PIGL2.coords = PIGL2_occ_final[c(3,2)]
rangeSize(PIGL2.coords, crs = "epsg:4267")
```

Subset for Pinus palustris

```{r}
PIPA2.occ = gbif %>%
  filter(species == "Pinus palustris") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
PIPA2.range = st_read("../../USTreeAtlas/shp/pinupalu/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(PIPA2.range)  <- 4267 
```

```{r}
PIPA2_clipped = st_intersection(PIPA2.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = PIPA2_clipped, col = "red", linewidth = 2)+
  geom_point(data = PIPA2.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
PIPA2_clipped$species = "Pinus palustris"
PIPA2_flag = cc_iucn(x = PIPA2.occ, range = PIPA2_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
PIPA2_occ_final = PIPA2.occ[PIPA2_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = PIPA2_clipped, col = "red", linewidth = 2)+
  geom_point(data = PIPA2_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/PIPA2.range.pdf", width = 12, height = 8)
```

```{r}
PIPA2.coords = PIPA2_occ_final[c(3,2)]
rangeSize(PIPA2.coords, crs = "epsg:4267")
```

Subset for Pinus pungens

```{r}
PIPUS.occ = gbif %>%
  filter(species == "Pinus pungens") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
PIPUS.range = st_read("../../USTreeAtlas/shp/pinupung/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(PIPUS.range)  <- 4267 
```

```{r}
PIPUS_clipped = st_intersection(PIPUS.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = PIPUS_clipped, col = "red", linewidth = 2)+
  geom_point(data = PIPUS.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
PIPUS_clipped$species = "Pinus pungens"
PIPUS_flag = cc_iucn(x = PIPUS.occ, range = PIPUS_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
PIPUS_occ_final = PIPUS.occ[PIPUS_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = PIPUS_clipped, col = "red", linewidth = 2)+
  geom_point(data = PIPUS_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/PIPUS.range.pdf", width = 12, height = 8)
```

```{r}
PIPUS.coords = PIPUS_occ_final[c(3,2)]
rangeSize(PIPUS.coords, crs = "epsg:4267")
```

Subset for Pinus resinosa

```{r}
PIRE.occ = gbif %>%
  filter(species == "Pinus resinosa") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
PIRE.range = st_read("../../USTreeAtlas/shp/pinuresi/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(PIRE.range)  <- 4267 
```

```{r}
PIRE_clipped = st_intersection(PIRE.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = PIRE_clipped, col = "red", linewidth = 2)+
  geom_point(data = PIRE.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
PIRE_clipped$species = "Pinus resinosa"
PIRE_flag = cc_iucn(x = PIRE.occ, range = PIRE_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
PIRE_occ_final = PIRE.occ[PIRE_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = PIRE_clipped, col = "red", linewidth = 2)+
  geom_point(data = PIRE_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/PIRE.range.pdf", width = 12, height = 8)
```

```{r}
PIRE.coords = PIRE_occ_final[c(3,2)]
rangeSize(PIRE.coords, crs = "epsg:4267")
```

Subset for Pinus rigida

```{r}
PIRI.occ = gbif %>%
  filter(species == "Pinus rigida") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
PIRI.range = st_read("../../USTreeAtlas/shp/pinurigi/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(PIRI.range)  <- 4267 
```

```{r}
PIRI_clipped = st_intersection(PIRI.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = PIRI_clipped, col = "red", linewidth = 2)+
  geom_point(data = PIRI.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
PIRI_clipped$species = "Pinus rigida"
PIRI_flag = cc_iucn(x = PIRI.occ, range = PIRI_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
PIRI_occ_final = PIRI.occ[PIRI_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = PIRI_clipped, col = "red", linewidth = 2)+
  geom_point(data = PIRI_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/PIRI.range.pdf", width = 12, height = 8)
```

```{r}
PIRI.coords = PIRI_occ_final[c(3,2)]
rangeSize(PIRI.coords, crs = "epsg:4267")
```

Subset for Pinus serotina

```{r}
PISE.occ = gbif %>%
  filter(species == "Pinus serotina") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
PISE.range = st_read("../../USTreeAtlas/shp/pinusero/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(PISE.range)  <- 4267 
```

```{r}
PISE_clipped = st_intersection(PISE.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = PISE_clipped, col = "red", linewidth = 2)+
  geom_point(data = PISE.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
PISE_clipped$species = "Pinus serotina"
PISE_flag = cc_iucn(x = PISE.occ, range = PISE_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
PISE_occ_final = PISE.occ[PISE_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = PISE_clipped, col = "red", linewidth = 2)+
  geom_point(data = PISE_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/PISE.range.pdf", width = 12, height = 8)
```

```{r}
PISE.coords = PISE_occ_final[c(3,2)]
rangeSize(PISE.coords, crs = "epsg:4267")
```

Subset for Pinus strobus

```{r}
PIST.occ = gbif %>%
  filter(species == "Pinus strobus") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
PIST.range = st_read("../../USTreeAtlas/shp/pinustrb/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(PIST.range)  <- 4267 
```

```{r}
PIST_clipped = st_intersection(PIST.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = PIST_clipped, col = "red", linewidth = 2)+
  geom_point(data = PIST.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
PIST_clipped$species = "Pinus strobus"
PIST_flag = cc_iucn(x = PIST.occ, range = PIST_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
PIST_occ_final = PIST.occ[PIST_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = PIST_clipped, col = "red", linewidth = 2)+
  geom_point(data = PIST_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/PIST.range.pdf", width = 12, height = 8)
```

```{r}
PIST.coords = PIST_occ_final[c(3,2)]
rangeSize(PIST.coords, crs = "epsg:4267")
```

Subset for Pinus taeda

```{r}
PITA.occ = gbif %>%
  filter(species == "Pinus taeda") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
PITA.range = st_read("../../USTreeAtlas/shp/pinutaed/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(PITA.range)  <- 4267 
```

```{r}
PITA_clipped = st_intersection(PITA.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = PITA_clipped, col = "red", linewidth = 2)+
  geom_point(data = PITA.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
PITA_clipped$species = "Pinus taeda"
PITA_flag = cc_iucn(x = PITA.occ, range = PITA_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
PITA_occ_final = PITA.occ[PITA_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = PITA_clipped, col = "red", linewidth = 2)+
  geom_point(data = PITA_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/PITA.range.pdf", width = 12, height = 8)
```

```{r}
PITA.coords = PITA_occ_final[c(3,2)]
rangeSize(PITA.coords, crs = "epsg:4267")
```

Subset for Pinus virginiana

```{r}
PIVI2.occ = gbif %>%
  filter(species == "Pinus virginiana") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
PIVI2.range = st_read("../../USTreeAtlas/shp/pinuvirg/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(PIVI2.range)  <- 4267 
```

```{r}
PIVI2_clipped = st_intersection(PIVI2.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = PIVI2_clipped, col = "red", linewidth = 2)+
  geom_point(data = PIVI2.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
PIVI2_clipped$species = "Pinus virginiana"
PIVI2_flag = cc_iucn(x = PIVI2.occ, range = PIVI2_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
PIVI2_occ_final = PIVI2.occ[PIVI2_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = PIVI2_clipped, col = "red", linewidth = 2)+
  geom_point(data = PIVI2_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/PIVI2.range.pdf", width = 12, height = 8)
```

```{r}
PIVI2.coords = PIVI2_occ_final[c(3,2)]
rangeSize(PIVI2.coords, crs = "epsg:4267")
```

Subset for Planera aquatica

```{r}
PLAQ.occ = gbif %>%
  filter(species == "Planera aquatica") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
PLAQ.range = st_read("../../USTreeAtlas/shp/planaqua/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(PLAQ.range)  <- 4267 
```

```{r}
PLAQ_clipped = st_intersection(PLAQ.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = PLAQ_clipped, col = "red", linewidth = 2)+
  geom_point(data = PLAQ.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
PLAQ_clipped$species = "Planera aquatica"
PLAQ_flag = cc_iucn(x = PLAQ.occ, range = PLAQ_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
PLAQ_occ_final = PLAQ.occ[PLAQ_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = PLAQ_clipped, col = "red", linewidth = 2)+
  geom_point(data = PLAQ_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/PLAQ.range.pdf", width = 12, height = 8)
```

```{r}
PLAQ.coords = PLAQ_occ_final[c(3,2)]
rangeSize(PLAQ.coords, crs = "epsg:4267")
```

Subset for Platanus occidentalis

```{r}
PLOC.occ = gbif %>%
  filter(species == "Platanus occidentalis") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
PLOC.range = st_read("../../USTreeAtlas/shp/platocci/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(PLOC.range)  <- 4267 
```

```{r}
PLOC_clipped = st_intersection(PLOC.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = PLOC_clipped, col = "red", linewidth = 2)+
  geom_point(data = PLOC.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
PLOC_clipped$species = "Platanus occidentalis"
PLOC_flag = cc_iucn(x = PLOC.occ, range = PLOC_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
PLOC_occ_final = PLOC.occ[PLOC_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = PLOC_clipped, col = "red", linewidth = 2)+
  geom_point(data = PLOC_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/PLOC.range.pdf", width = 12, height = 8)
```

```{r}
PLOC.coords = PLOC_occ_final[c(3,2)]
rangeSize(PLOC.coords, crs = "epsg:4267")
```

Subset for Populus balsamifera

```{r}
POBA2.occ = gbif %>%
  filter(species == "Populus balsamifera") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
POBA2.range = st_read("../../USTreeAtlas/shp/popubals/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(POBA2.range)  <- 4267 
```

```{r}
POBA2_clipped = st_intersection(POBA2.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = POBA2_clipped, col = "red", linewidth = 2)+
  geom_point(data = POBA2.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
POBA2_clipped$species = "Populus balsamifera"
POBA2_flag = cc_iucn(x = POBA2.occ, range = POBA2_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
POBA2_occ_final = POBA2.occ[POBA2_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = POBA2_clipped, col = "red", linewidth = 2)+
  geom_point(data = POBA2_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/POBA2.range.pdf", width = 12, height = 8)
```

```{r}
POBA2.coords = POBA2_occ_final[c(3,2)]
rangeSize(POBA2.coords, crs = "epsg:4267")
```

Subset for Populus deltoides

```{r}
PODE3.occ = gbif %>%
  filter(species == "Populus deltoides") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
PODE3.range = st_read("../../USTreeAtlas/shp/popudelt/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(PODE3.range)  <- 4267 
```

```{r}
PODE3_clipped = st_intersection(PODE3.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = PODE3_clipped, col = "red", linewidth = 2)+
  geom_point(data = PODE3.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
PODE3_clipped$species = "Populus deltoides"
PODE3_flag = cc_iucn(x = PODE3.occ, range = PODE3_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
PODE3_occ_final = PODE3.occ[PODE3_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = PODE3_clipped, col = "red", linewidth = 2)+
  geom_point(data = PODE3_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/PODE3.range.pdf", width = 12, height = 8)
```

```{r}
PODE3.coords = PODE3_occ_final[c(3,2)]
rangeSize(PODE3.coords, crs = "epsg:4267")
```

Subset for Populus grandidentata

```{r}
POGR4.occ = gbif %>%
  filter(species == "Populus grandidentata") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
POGR4.range = st_read("../../USTreeAtlas/shp/popugran/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(POGR4.range)  <- 4267 
```

```{r}
POGR4_clipped = st_intersection(POGR4.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = POGR4_clipped, col = "red", linewidth = 2)+
  geom_point(data = POGR4.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
POGR4_clipped$species = "Populus grandidentata"
POGR4_flag = cc_iucn(x = POGR4.occ, range = POGR4_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
POGR4_occ_final = POGR4.occ[POGR4_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = POGR4_clipped, col = "red", linewidth = 2)+
  geom_point(data = POGR4_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/POGR4.range.pdf", width = 12, height = 8)
```

```{r}
POGR4.coords = POGR4_occ_final[c(3,2)]
rangeSize(POGR4.coords, crs = "epsg:4267")
```

Subset for Populus heterophylla

```{r}
POHE4.occ = gbif %>%
  filter(species == "Populus heterophylla") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
POHE4.range = st_read("../../USTreeAtlas/shp/popuhete/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(POHE4.range)  <- 4267 
```

```{r}
POHE4_clipped = st_intersection(POHE4.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = POHE4_clipped, col = "red", linewidth = 2)+
  geom_point(data = POHE4.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
POHE4_clipped$species = "Populus heterophylla"
POHE4_flag = cc_iucn(x = POHE4.occ, range = POHE4_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
POHE4_occ_final = POHE4.occ[POHE4_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = POHE4_clipped, col = "red", linewidth = 2)+
  geom_point(data = POHE4_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/POHE4.range.pdf", width = 12, height = 8)
```

```{r}
POHE4.coords = POHE4_occ_final[c(3,2)]
rangeSize(POHE4.coords, crs = "epsg:4267")
```

Subset for Populus tremuloides

```{r}
POTR5.occ = gbif %>%
  filter(species == "Populus tremuloides") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
POTR5.range = st_read("../../USTreeAtlas/shp/poputrem/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(POTR5.range)  <- 4267 
```

```{r}
POTR5_clipped = st_intersection(POTR5.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = POTR5_clipped, col = "red", linewidth = 2)+
  geom_point(data = POTR5.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
POTR5_clipped$species = "Populus tremuloides"
POTR5_flag = cc_iucn(x = POTR5.occ, range = POTR5_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
POTR5_occ_final = POTR5.occ[POTR5_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = POTR5_clipped, col = "red", linewidth = 2)+
  geom_point(data = POTR5_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/POTR5.range.pdf", width = 12, height = 8)
```

```{r}
POTR5.coords = POTR5_occ_final[c(3,2)]
rangeSize(POTR5.coords, crs = "epsg:4267")
```

Subset for Prunus americana

```{r}
PRAM.occ = gbif %>%
  filter(species == "Prunus americana") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
PRAM.range = st_read("../../USTreeAtlas/shp/prunamer/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(PRAM.range)  <- 4267 
```

```{r}
PRAM_clipped = st_intersection(PRAM.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = PRAM_clipped, col = "red", linewidth = 2)+
  geom_point(data = PRAM.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
PRAM_clipped$species = "Prunus americana"
PRAM_flag = cc_iucn(x = PRAM.occ, range = PRAM_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
PRAM_occ_final = PRAM.occ[PRAM_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = PRAM_clipped, col = "red", linewidth = 2)+
  geom_point(data = PRAM_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/PRAM.range.pdf", width = 12, height = 8)
```

```{r}
PRAM.coords = PRAM_occ_final[c(3,2)]
rangeSize(PRAM.coords, crs = "epsg:4267")
```

Subset for Prunus pensylvanica

```{r}
PRPE2.occ = gbif %>%
  filter(species == "Prunus pensylvanica") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
PRPE2.range = st_read("../../USTreeAtlas/shp/prunpens/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(PRPE2.range)  <- 4267 
```

```{r}
PRPE2_clipped = st_intersection(PRPE2.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = PRPE2_clipped, col = "red", linewidth = 2)+
  geom_point(data = PRPE2.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
PRPE2_clipped$species = "Prunus pensylvanica"
PRPE2_flag = cc_iucn(x = PRPE2.occ, range = PRPE2_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
PRPE2_occ_final = PRPE2.occ[PRPE2_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = PRPE2_clipped, col = "red", linewidth = 2)+
  geom_point(data = PRPE2_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/PRPE2.range.pdf", width = 12, height = 8)
```

```{r}
PRPE2.coords = PRPE2_occ_final[c(3,2)]
rangeSize(PRPE2.coords, crs = "epsg:4267")
```

Subset for Prunus serotina

```{r}
PRSE2.occ = gbif %>%
  filter(species == "Prunus serotina") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
PRSE2.range = st_read("../../USTreeAtlas/shp/prunsero/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(PRSE2.range)  <- 4267 
```

```{r}
PRSE2_clipped = st_intersection(PRSE2.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = PRSE2_clipped, col = "red", linewidth = 2)+
  geom_point(data = PRSE2.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
PRSE2_clipped$species = "Prunus serotina"
PRSE2_flag = cc_iucn(x = PRSE2.occ, range = PRSE2_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
PRSE2_occ_final = PRSE2.occ[PRSE2_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = PRSE2_clipped, col = "red", linewidth = 2)+
  geom_point(data = PRSE2_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/PRSE2.range.pdf", width = 12, height = 8)
```

```{r}
PRSE2.coords = PRSE2_occ_final[c(3,2)]
rangeSize(PRSE2.coords, crs = "epsg:4267")
```

Subset for Prunus virginiana

```{r}
PRVI.occ = gbif %>%
  filter(species == "Prunus virginiana") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
PRVI.range = st_read("../../USTreeAtlas/shp/prunvirg/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(PRVI.range)  <- 4267 
```

```{r}
PRVI_clipped = st_intersection(PRVI.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = PRVI_clipped, col = "red", linewidth = 2)+
  geom_point(data = PRVI.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
PRVI_clipped$species = "Prunus virginiana"
PRVI_flag = cc_iucn(x = PRVI.occ, range = PRVI_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
PRVI_occ_final = PRVI.occ[PRVI_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = PRVI_clipped, col = "red", linewidth = 2)+
  geom_point(data = PRVI_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/PRVI.range.pdf", width = 12, height = 8)
```

```{r}
PRVI.coords = PRVI_occ_final[c(3,2)]
rangeSize(PRVI.coords, crs = "epsg:4267")
```

Subset for Quercus alba

```{r}
QUAL.occ = gbif %>%
  filter(species == "Quercus alba") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
QUAL.range = st_read("../../USTreeAtlas/shp/queralba/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(QUAL.range)  <- 4267 
```

```{r}
QUAL_clipped = st_intersection(QUAL.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = QUAL_clipped, col = "red", linewidth = 2)+
  geom_point(data = QUAL.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
QUAL_clipped$species = "Quercus alba"
QUAL_flag = cc_iucn(x = QUAL.occ, range = QUAL_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
QUAL_occ_final = QUAL.occ[QUAL_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = QUAL_clipped, col = "red", linewidth = 2)+
  geom_point(data = QUAL_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/QUAL.range.pdf", width = 12, height = 8)
```

```{r}
QUAL.coords = QUAL_occ_final[c(3,2)]
rangeSize(QUAL.coords, crs = "epsg:4267")
```

Subset for Quercus bicolor

```{r}
QUBI.occ = gbif %>%
  filter(species == "Quercus bicolor") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
QUBI.range = st_read("../../USTreeAtlas/shp/querbico/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(QUBI.range)  <- 4267 
```

```{r}
QUBI_clipped = st_intersection(QUBI.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = QUBI_clipped, col = "red", linewidth = 2)+
  geom_point(data = QUBI.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
QUBI_clipped$species = "Quercus bicolor"
QUBI_flag = cc_iucn(x = QUBI.occ, range = QUBI_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
QUBI_occ_final = QUBI.occ[QUBI_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = QUBI_clipped, col = "red", linewidth = 2)+
  geom_point(data = QUBI_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/QUBI.range.pdf", width = 12, height = 8)
```

```{r}
QUBI.coords = QUBI_occ_final[c(3,2)]
rangeSize(QUBI.coords, crs = "epsg:4267")
```

Subset for Quercus coccinea

```{r}
QUCO2.occ = gbif %>%
  filter(species == "Quercus coccinea") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
QUCO2.range = st_read("../../USTreeAtlas/shp/quercocc/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(QUCO2.range)  <- 4267 
```

```{r}
QUCO2_clipped = st_intersection(QUCO2.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = QUCO2_clipped, col = "red", linewidth = 2)+
  geom_point(data = QUCO2.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
QUCO2_clipped$species = "Quercus coccinea"
QUCO2_flag = cc_iucn(x = QUCO2.occ, range = QUCO2_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
QUCO2_occ_final = QUCO2.occ[QUCO2_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = QUCO2_clipped, col = "red", linewidth = 2)+
  geom_point(data = QUCO2_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/QUCO2.range.pdf", width = 12, height = 8)
```

```{r}
QUCO2.coords = QUCO2_occ_final[c(3,2)]
rangeSize(QUCO2.coords, crs = "epsg:4267")
```

Subset for Quercus ellipsoidalis

```{r}
QUEL.occ = gbif %>%
  filter(species == "Quercus ellipsoidalis") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
QUEL.range = st_read("../../USTreeAtlas/shp/querelli/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(QUEL.range)  <- 4267 
```

```{r}
QUEL_clipped = st_intersection(QUEL.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = QUEL_clipped, col = "red", linewidth = 2)+
  geom_point(data = QUEL.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
QUEL_clipped$species = "Quercus ellipsoidalis"
QUEL_flag = cc_iucn(x = QUEL.occ, range = QUEL_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
QUEL_occ_final = QUEL.occ[QUEL_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = QUEL_clipped, col = "red", linewidth = 2)+
  geom_point(data = QUEL_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/QUEL.range.pdf", width = 12, height = 8)
```

```{r}
QUEL.coords = QUEL_occ_final[c(3,2)]
rangeSize(QUEL.coords, crs = "epsg:4267")
```

Subset for Quercus falcata

```{r}
QUFA.occ = gbif %>%
  filter(species == "Quercus falcata") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
QUFA.range = st_read("../../USTreeAtlas/shp/querfalc/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(QUFA.range)  <- 4267 
```

```{r}
QUFA_clipped = st_intersection(QUFA.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = QUFA_clipped, col = "red", linewidth = 2)+
  geom_point(data = QUFA.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
QUFA_clipped$species = "Quercus falcata"
QUFA_flag = cc_iucn(x = QUFA.occ, range = QUFA_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
QUFA_occ_final = QUFA.occ[QUFA_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = QUFA_clipped, col = "red", linewidth = 2)+
  geom_point(data = QUFA_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/QUFA.range.pdf", width = 12, height = 8)
```

```{r}
QUFA.coords = QUFA_occ_final[c(3,2)]
rangeSize(QUFA.coords, crs = "epsg:4267")
```

Subset for Quercus ilicifolia

```{r}
QUIL.occ = gbif %>%
  filter(species == "Quercus ilicifolia") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
QUIL.range = st_read("../../USTreeAtlas/shp/querilic/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(QUIL.range)  <- 4267 
```

```{r}
QUIL_clipped = st_intersection(QUIL.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = QUIL_clipped, col = "red", linewidth = 2)+
  geom_point(data = QUIL.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
QUIL_clipped$species = "Quercus ilicifolia"
QUIL_flag = cc_iucn(x = QUIL.occ, range = QUIL_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
QUIL_occ_final = QUIL.occ[QUIL_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = QUIL_clipped, col = "red", linewidth = 2)+
  geom_point(data = QUIL_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/QUIL.range.pdf", width = 12, height = 8)
```

```{r}
QUIL.coords = QUIL_occ_final[c(3,2)]
rangeSize(QUIL.coords, crs = "epsg:4267")
```


Subset for Quercus imbricaria

```{r}
QUIM.occ = gbif %>%
  filter(species == "Quercus imbricaria") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
QUIM.range = st_read("../../USTreeAtlas/shp/querimbr/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(QUIM.range)  <- 4267 
```

```{r}
QUIM_clipped = st_intersection(QUIM.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = QUIM_clipped, col = "red", linewidth = 2)+
  geom_point(data = QUIM.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
QUIM_clipped$species = "Quercus imbricaria"
QUIM_flag = cc_iucn(x = QUIM.occ, range = QUIM_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
QUIM_occ_final = QUIM.occ[QUIM_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = QUIM_clipped, col = "red", linewidth = 2)+
  geom_point(data = QUIM_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/QUIM.range.pdf", width = 12, height = 8)
```

```{r}
QUIM.coords = QUIM_occ_final[c(3,2)]
rangeSize(QUIM.coords, crs = "epsg:4267")
```

Subset for Quercus incana

```{r}
QUIN.occ = gbif %>%
  filter(species == "Quercus incana") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
QUIN.range = st_read("../../USTreeAtlas/shp/querinca/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(QUIN.range)  <- 4267 
```

```{r}
QUIN_clipped = st_intersection(QUIN.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = QUIN_clipped, col = "red", linewidth = 2)+
  geom_point(data = QUIN.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
QUIN_clipped$species = "Quercus incana"
QUIN_flag = cc_iucn(x = QUIN.occ, range = QUIN_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
QUIN_occ_final = QUIN.occ[QUIN_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = QUIN_clipped, col = "red", linewidth = 2)+
  geom_point(data = QUIN_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/QUIN.range.pdf", width = 12, height = 8)
```

```{r}
QUIN.coords = QUIN_occ_final[c(3,2)]
rangeSize(QUIN.coords, crs = "epsg:4267")
```

Subset for Quercus laevis

```{r}
QULA2.occ = gbif %>%
  filter(species == "Quercus laevis") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
QULA2.range = st_read("../../USTreeAtlas/shp/querlaev/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(QULA2.range)  <- 4267 
```

```{r}
QULA2_clipped = st_intersection(QULA2.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = QULA2_clipped, col = "red", linewidth = 2)+
  geom_point(data = QULA2.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
QULA2_clipped$species = "Quercus laevis"
QULA2_flag = cc_iucn(x = QULA2.occ, range = QULA2_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
QULA2_occ_final = QULA2.occ[QULA2_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = QULA2_clipped, col = "red", linewidth = 2)+
  geom_point(data = QULA2_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/QULA2.range.pdf", width = 12, height = 8)
```

```{r}
QULA2.coords = QULA2_occ_final[c(3,2)]
rangeSize(QULA2.coords, crs = "epsg:4267")
```

Subset for Quercus laurifolia

```{r}
QULA3.occ = gbif %>%
  filter(species == "Quercus laurifolia") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
QULA3.range = st_read("../../USTreeAtlas/shp/querlaur/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(QULA3.range)  <- 4267 
```

```{r}
QULA3_clipped = st_intersection(QULA3.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = QULA3_clipped, col = "red", linewidth = 2)+
  geom_point(data = QULA3.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
QULA3_clipped$species = "Quercus laurifolia"
QULA3_flag = cc_iucn(x = QULA3.occ, range = QULA3_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
QULA3_occ_final = QULA3.occ[QULA3_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = QULA3_clipped, col = "red", linewidth = 2)+
  geom_point(data = QULA3_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/QULA3.range.pdf", width = 12, height = 8)
```

```{r}
QULA3.coords = QULA3_occ_final[c(3,2)]
rangeSize(QULA3.coords, crs = "epsg:4267")
```

Subset for Quercus lyrata

```{r}
QULY.occ = gbif %>%
  filter(species == "Quercus lyrata") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
QULY.range = st_read("../../USTreeAtlas/shp/querlyra/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(QULY.range)  <- 4267 
```

```{r}
QULY_clipped = st_intersection(QULY.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = QULY_clipped, col = "red", linewidth = 2)+
  geom_point(data = QULY.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
QULY_clipped$species = "Quercus lyrata"
QULY_flag = cc_iucn(x = QULY.occ, range = QULY_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
QULY_occ_final = QULY.occ[QULY_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = QULY_clipped, col = "red", linewidth = 2)+
  geom_point(data = QULY_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/QULY.range.pdf", width = 12, height = 8)
```

```{r}
QULY.coords = QULY_occ_final[c(3,2)]
rangeSize(QULY.coords, crs = "epsg:4267")
```


Subset for Quercus macrocarpa

```{r}
QUMA2.occ = gbif %>%
  filter(species == "Quercus macrocarpa") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
QUMA2.range = st_read("../../USTreeAtlas/shp/quermacr/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(QUMA2.range)  <- 4267 
```

```{r}
QUMA2_clipped = st_intersection(QUMA2.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = QUMA2_clipped, col = "red", linewidth = 2)+
  geom_point(data = QUMA2.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
QUMA2_clipped$species = "Quercus macrocarpa"
QUMA2_flag = cc_iucn(x = QUMA2.occ, range = QUMA2_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
QUMA2_occ_final = QUMA2.occ[QUMA2_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = QUMA2_clipped, col = "red", linewidth = 2)+
  geom_point(data = QUMA2_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/QUMA2.range.pdf", width = 12, height = 8)
```

```{r}
QUMA2.coords = QUMA2_occ_final[c(3,2)]
rangeSize(QUMA2.coords, crs = "epsg:4267")
```

Subset for Quercus margaretta. Little range map not available. Quercus margarettiae in Atlas. Quercus margarettae in BIEN.

```{r}
QUMA6.occ = gbif %>%
  filter(species == "Quercus margaretta") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Get range map from BIEN

```{r}
(QUMA6.range.sf <- BIEN_ranges_load_species('Quercus margarettae'))
```
The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The BIEN ranges are WG84.

```{r}
QUMA6.range.2 = QUMA6.range.sf %>%
  st_transform(st_crs(states.map))
```

```{r}
QUMA6.range.3 = terra::vect(QUMA6.range.2)
states.map.2 = terra::vect(states.map)
```

```{r}
QUMA6.range.4 = terra::intersect(QUMA6.range.3, states.map.2)
```

```{r}
QUMA6.range.5 = st_as_sf(QUMA6.range.4)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(dat = QUMA6.range.5, col = "red", linewidth = 2)+
  geom_point(data = QUMA6.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
QUMA6.range.5$species = "Quercus margaretta"
QUMA6_flag = cc_iucn(x = QUMA6.occ, range = QUMA6.range.5, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
QUMA6_occ_final = QUMA6.occ[QUMA6_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = QUMA6.range.5, col = "red", linewidth = 2)+
  geom_point(data = QUMA6_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/QUMA6.range.pdf", width = 12, height = 8)
```

```{r}
QUMA6.coords = QUMA6_occ_final[c(3,2)]
rangeSize(QUMA6.coords, crs = "epsg:4267")
```

Subset for Quercus marilandica

```{r}
QUMA3.occ = gbif %>%
  filter(species == "Quercus marilandica") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
QUMA3.range = st_read("../../USTreeAtlas/shp/quermari/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(QUMA3.range)  <- 4267 
```

```{r}
QUMA3_clipped = st_intersection(QUMA3.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = QUMA3_clipped, col = "red", linewidth = 2)+
  geom_point(data = QUMA3.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
QUMA3_clipped$species = "Quercus marilandica"
QUMA3_flag = cc_iucn(x = QUMA3.occ, range = QUMA3_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
QUMA3_occ_final = QUMA3.occ[QUMA3_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = QUMA3_clipped, col = "red", linewidth = 2)+
  geom_point(data = QUMA3_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/QUMA3.range.pdf", width = 12, height = 8)
```

```{r}
QUMA3.coords = QUMA3_occ_final[c(3,2)]
rangeSize(QUMA3.coords, crs = "epsg:4267")
```


Subset for Quercus michauxii (gbif) and Quercus prinus

```{r}
QUMI.occ = gbif %>%
  filter(species == "Quercus michauxii") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
QUMI.range = st_read("../../USTreeAtlas/shp/quermich/")
QUPR2.range = st_read("../../USTreeAtlas/shp/querprin/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(QUMI.range)  <- 4267 
st_crs(QUPR2.range)  <- 4267 
```

```{r}
QUMI_QUPR2.range = bind_rows(QUMI.range, QUPR2.range)
```


```{r}
QUMI_QUPR2_clipped = st_intersection(QUMI_QUPR2.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = QUMI_QUPR2_clipped, col = "red", linewidth = 2)+
  geom_point(data = QUMI.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
QUMI_QUPR2_clipped$species = "Quercus michauxii"
QUMI_QUPR2_flag = cc_iucn(x = QUMI.occ, range = QUMI_QUPR2_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
QUMI_QUPR2_occ_final = QUMI.occ[QUMI_QUPR2_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = QUMI_QUPR2_clipped, col = "red", linewidth = 2)+
  geom_point(data = QUMI_QUPR2_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/QUPR2.range.pdf", width = 12, height = 8)
```

```{r}
QUPR2.coords = QUPR2_occ_final[c(3,2)]
rangeSize(QUPR2.coords, crs = "epsg:4267")
```

Subset for Quercus minima. Little range map not available.

```{r}
QUMI2.occ = gbif %>%
  filter(species == "Quercus minima") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Get range map from BIEN

```{r}
(QUMI2.range.sf <- BIEN_ranges_load_species('Quercus minima'))
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The BIEN ranges are WG84.

```{r}
QUMI2.range.2 = QUMI2.range.sf %>%
  st_transform(st_crs(states.map))
```

```{r}
QUMI2.range.3 = terra::vect(QUMI2.range.2)
states.map.2 = terra::vect(states.map)
```

```{r}
QUMI2.range.4 = terra::intersect(QUMI2.range.3, states.map.2)
```

```{r}
QUMI2.range.5 = st_as_sf(QUMI2.range.4)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(dat = QUMI2.range.5, col = "red", linewidth = 2)+
  geom_point(data = QUMI2.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
QUMI2.range.5$species = "Quercus minima"
QUMI2_flag = cc_iucn(x = QUMI2.occ, range = QUMI2.range.5, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
QUMI2_occ_final = QUMI2.occ[QUMI2_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = QUMI2.range.5, col = "red", linewidth = 2)+
  geom_point(data = QUMI2_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/QUMI2.range.pdf", width = 12, height = 8)
```

```{r}
QUMI2.coords = QUMI2_occ_final[c(3,2)]
rangeSize(QUMI2.coords, crs = "epsg:4267")
```


Subset for Quercus muehlenbergii

```{r}
QUMU.occ = gbif %>%
  filter(species == "Quercus muehlenbergii") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
QUMU.range = st_read("../../USTreeAtlas/shp/quermueh/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(QUMU.range)  <- 4267 
```

```{r}
QUMU_clipped = st_intersection(QUMU.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = QUMU_clipped, col = "red", linewidth = 2)+
  geom_point(data = QUMU.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
QUMU_clipped$species = "Quercus muehlenbergii"
QUMU_flag = cc_iucn(x = QUMU.occ, range = QUMU_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
QUMU_occ_final = QUMU.occ[QUMU_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = QUMU_clipped, col = "red", linewidth = 2)+
  geom_point(data = QUMU_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/QUMU.range.pdf", width = 12, height = 8)
```

```{r}
QUMU.coords = QUMU_occ_final[c(3,2)]
rangeSize(QUMU.coords, crs = "epsg:4267")
```

Subset for Quercus nigra

```{r}
QUNI.occ = gbif %>%
  filter(species == "Quercus nigra") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
QUNI.range = st_read("../../USTreeAtlas/shp/quernigr/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(QUNI.range)  <- 4267 
```

```{r}
QUNI_clipped = st_intersection(QUNI.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = QUNI_clipped, col = "red", linewidth = 2)+
  geom_point(data = QUNI.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
QUNI_clipped$species = "Quercus nigra"
QUNI_flag = cc_iucn(x = QUNI.occ, range = QUNI_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
QUNI_occ_final = QUNI.occ[QUNI_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = QUNI_clipped, col = "red", linewidth = 2)+
  geom_point(data = QUNI_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/QUNI.range.pdf", width = 12, height = 8)
```

```{r}
QUNI.coords = QUNI_occ_final[c(3,2)]
rangeSize(QUNI.coords, crs = "epsg:4267")
```

Subset for Quercus pagoda. Little range map available not available.

```{r}
QUPA5.occ = gbif %>%
  filter(species == "Quercus pagoda") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Get range map from BIEN

```{r}
(QUPA5.range.sf <- BIEN_ranges_load_species('Quercus pagoda'))
```
The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The BIEN ranges are WG84.

```{r}
QUPA5.range.2 = QUPA5.range.sf %>%
  st_transform(st_crs(states.map))
```

```{r}
QUPA5.range.3 = terra::vect(QUPA5.range.2)
states.map.2 = terra::vect(states.map)
```

```{r}
QUPA5.range.4 = terra::intersect(QUPA5.range.3, states.map.2)
```

```{r}
QUPA5.range.5 = st_as_sf(QUPA5.range.4)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(dat = QUPA5.range.5, col = "red", linewidth = 2)+
  geom_point(data = QUPA5.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```


```{r}
QUPA5.range.5$species = "Quercus pagoda"
QUPA5_flag = cc_iucn(x = QUPA5.occ, range = QUPA5.range.5, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
QUPA5_occ_final = QUPA5.occ[QUPA5_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = QUPA5.range.5, col = "red", linewidth = 2)+
  geom_point(data = QUPA5_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/QUPA5.range.pdf", width = 12, height = 8)
```

```{r}
QUPA5.coords = QUPA5_occ_final[c(3,2)]
rangeSize(QUPA5.coords, crs = "epsg:4267")
```

Subset for Quercus palustris

```{r}
QUPA2.occ = gbif %>%
  filter(species == "Quercus palustris") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
QUPA2.range = st_read("../../USTreeAtlas/shp/querpalu/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(QUPA2.range)  <- 4267 
```

```{r}
QUPA2_clipped = st_intersection(QUPA2.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = QUPA2_clipped, col = "red", linewidth = 2)+
  geom_point(data = QUPA2.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
QUPA2_clipped$species = "Quercus palustris"
QUPA2_flag = cc_iucn(x = QUPA2.occ, range = QUPA2_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
QUPA2_occ_final = QUPA2.occ[QUPA2_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = QUPA2_clipped, col = "red", linewidth = 2)+
  geom_point(data = QUPA2_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/QUPA2.range.pdf", width = 12, height = 8)
```

```{r}
QUPA2.coords = QUPA2_occ_final[c(3,2)]
rangeSize(QUPA2.coords, crs = "epsg:4267")
```

Subset for Quercus phellos

```{r}
QUPH.occ = gbif %>%
  filter(species == "Quercus phellos") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
QUPH.range = st_read("../../USTreeAtlas/shp/querphel/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(QUPH.range)  <- 4267 
```

```{r}
QUPH_clipped = st_intersection(QUPH.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = QUPH_clipped, col = "red", linewidth = 2)+
  geom_point(data = QUPH.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
QUPH_clipped$species = "Quercus phellos"
QUPH_flag = cc_iucn(x = QUPH.occ, range = QUPH_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
QUPH_occ_final = QUPH.occ[QUPH_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = QUPH_clipped, col = "red", linewidth = 2)+
  geom_point(data = QUPH_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/QUPH.range.pdf", width = 12, height = 8)
```

```{r}
QUPH.coords = QUPH_occ_final[c(3,2)]
rangeSize(QUPH.coords, crs = "epsg:4267")
```

Subset for Quercus rubra

```{r}
QURU.occ = gbif %>%
  filter(species == "Quercus rubra") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
QURU.range = st_read("../../USTreeAtlas/shp/querrubr/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(QURU.range)  <- 4267 
```

```{r}
QURU_clipped = st_intersection(QURU.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = QURU_clipped, col = "red", linewidth = 2)+
  geom_point(data = QURU.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
QURU_clipped$species = "Quercus rubra"
QURU_flag = cc_iucn(x = QURU.occ, range = QURU_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
QURU_occ_final = QURU.occ[QURU_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = QURU_clipped, col = "red", linewidth = 2)+
  geom_point(data = QURU_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/QURU.range.pdf", width = 12, height = 8)
```

```{r}
QURU.coords = QURU_occ_final[c(3,2)]
rangeSize(QURU.coords, crs = "epsg:4267")
```

Subset for Quercus shumardii

```{r}
QUSH.occ = gbif %>%
  filter(species == "Quercus shumardii") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
QUSH.range = st_read("../../USTreeAtlas/shp/quershum/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(QUSH.range)  <- 4267 
```

```{r}
QUSH_clipped = st_intersection(QUSH.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = QUSH_clipped, col = "red", linewidth = 2)+
  geom_point(data = QUSH.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
QUSH_clipped$species = "Quercus shumardii"
QUSH_flag = cc_iucn(x = QUSH.occ, range = QUSH_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
QUSH_occ_final = QUSH.occ[QUSH_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = QUSH_clipped, col = "red", linewidth = 2)+
  geom_point(data = QUSH_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/QUSH.range.pdf", width = 12, height = 8)
```

```{r}
QUSH.coords = QUSH_occ_final[c(3,2)]
rangeSize(QUSH.coords, crs = "epsg:4267")
```

Subset for Quercus sinuata. Little range map not available.

```{r}
QUSIS.occ = gbif %>%
  filter(species == "Quercus sinuata") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Get range map from BIEN

```{r}
(QUSIS.range.sf <- BIEN_ranges_load_species('Quercus sinuata'))
```
The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The BIEN ranges are WG84.

```{r}
QUSIS.range.2 = QUSIS.range.sf %>%
  st_transform(st_crs(states.map))
```

```{r}
QUSIS.range.3 = terra::vect(QUSIS.range.2)
states.map.2 = terra::vect(states.map)
```

```{r}
QUSIS.range.4 = terra::intersect(QUSIS.range.3, states.map.2)
```

```{r}
QUSIS.range.5 = st_as_sf(QUSIS.range.4)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(dat = QUSIS.range.5, col = "red", linewidth = 2)+
  geom_point(data = QUSIS.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
QUSIS.range.5$species = "Quercus sinuata"
QUSIS_flag = cc_iucn(x = QUSIS.occ, range = QUSIS.range.5, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
QUSIS_occ_final = QUSIS.occ[QUSIS_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = QUSIS.range.5, col = "red", linewidth = 2)+
  geom_point(data = QUSIS_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/QUSIS.range.pdf", width = 12, height = 8)
```

```{r}
QUSIS.coords = QUSIS_occ_final[c(3,2)]
rangeSize(QUSIS.coords, crs = "epsg:4267")
```

Subset for Quercus stellata

```{r}
QUST.occ = gbif %>%
  filter(species == "Quercus stellata") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
QUST.range = st_read("../../USTreeAtlas/shp/querstel/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(QUST.range)  <- 4267 
```

```{r}
QUST_clipped = st_intersection(QUST.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = QUST_clipped, col = "red", linewidth = 2)+
  geom_point(data = QUST.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
QUST_clipped$species = "Quercus stellata"
QUST_flag = cc_iucn(x = QUST.occ, range = QUST_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
QUST_occ_final = QUST.occ[QUST_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = QUST_clipped, col = "red", linewidth = 2)+
  geom_point(data = QUST_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/QUST.range.pdf", width = 12, height = 8)
```

```{r}
QUST.coords = QUST_occ_final[c(3,2)]
rangeSize(QUST.coords, crs = "epsg:4267")
```

Subset for Quercus texana. Little range map not available.

```{r}
QUTE.occ = gbif %>%
  filter(species == "Quercus texana") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Get range map from BIEN

```{r}
(QUTE.range.sf <- BIEN_ranges_load_species('Quercus texana'))
```
The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The BIEN ranges are WG84.

```{r}
QUTE.range.2 = QUTE.range.sf %>%
  st_transform(st_crs(states.map))
```

```{r}
QUTE.range.3 = terra::vect(QUTE.range.2)
states.map.2 = terra::vect(states.map)
```

```{r}
QUTE.range.4 = terra::intersect(QUTE.range.3, states.map.2)
```

```{r}
QUTE.range.5 = st_as_sf(QUTE.range.4)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(dat = QUTE.range.5, col = "red", linewidth = 2)+
  geom_point(data = QUTE.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
QUTE.range.5$species = "Quercus texana"
QUTE_flag = cc_iucn(x = QUTE.occ, range = QUTE.range.5, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
QUTE_occ_final = QUTE.occ[QUTE_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = QUTE.range.5, col = "red", linewidth = 2)+
  geom_point(data = QUTE_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/QUTE.range.pdf", width = 12, height = 8)
```

```{r}
QUTE.coords = QUTE_occ_final[c(3,2)]
rangeSize(QUTE.coords, crs = "epsg:4267")
```

Subset for Quercus velutina

```{r}
QUVE.occ = gbif %>%
  filter(species == "Quercus velutina") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
QUVE.range = st_read("../../USTreeAtlas/shp/quervelu/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(QUVE.range)  <- 4267 
```

```{r}
QUVE_clipped = st_intersection(QUVE.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = QUVE_clipped, col = "red", linewidth = 2)+
  geom_point(data = QUVE.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
QUVE_clipped$species = "Quercus velutina"
QUVE_flag = cc_iucn(x = QUVE.occ, range = QUVE_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
QUVE_occ_final = QUVE.occ[QUVE_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = QUVE_clipped, col = "red", linewidth = 2)+
  geom_point(data = QUVE_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/QUVE.range.pdf", width = 12, height = 8)
```

```{r}
QUVE.coords = QUVE_occ_final[c(3,2)]
rangeSize(QUVE.coords, crs = "epsg:4267")
```

Subset for Quercus virginiana

```{r}
QUVI.occ = gbif %>%
  filter(species == "Quercus virginiana") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
QUVI.range = st_read("../../USTreeAtlas/shp/quervirg/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(QUVI.range)  <- 4267 
```

```{r}
QUVI_clipped = st_intersection(QUVI.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = QUVI_clipped, col = "red", linewidth = 2)+
  geom_point(data = QUVI.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
QUVI_clipped$species = "Quercus virginiana"
QUVI_flag = cc_iucn(x = QUVI.occ, range = QUVI_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
QUVI_occ_final = QUVI.occ[QUVI_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = QUVI_clipped, col = "red", linewidth = 2)+
  geom_point(data = QUVI_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/QUVI.range.pdf", width = 12, height = 8)
```

```{r}
QUVI.coords = QUVI_occ_final[c(3,2)]
rangeSize(QUVI.coords, crs = "epsg:4267")
```

Subset for Robinia pseudoacacia

```{r}
ROPS.occ = gbif %>%
  filter(species == "Robinia pseudoacacia") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
ROPS.range = st_read("../../USTreeAtlas/shp/robipseu/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(ROPS.range)  <- 4267 
```

```{r}
ROPS_clipped = st_intersection(ROPS.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = ROPS_clipped, col = "red", linewidth = 2)+
  geom_point(data = ROPS.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
ROPS_clipped$species = "Robinia pseudoacacia"
ROPS_flag = cc_iucn(x = ROPS.occ, range = ROPS_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
ROPS_occ_final = ROPS.occ[ROPS_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = ROPS_clipped, col = "red", linewidth = 2)+
  geom_point(data = ROPS_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/ROPS.range.pdf", width = 12, height = 8)
```

```{r}
ROPS.coords = ROPS_occ_final[c(3,2)]
rangeSize(ROPS.coords, crs = "epsg:4267")
```

Subset for Salix caroliniana

```{r}
CACA5.occ = gbif %>%
  filter(species == "Salix caroliniana") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
CACA5.range = st_read("../../USTreeAtlas/shp/salicaro/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(CACA5.range)  <- 4267 
```

```{r}
CACA5_clipped = st_intersection(CACA5.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = CACA5_clipped, col = "red", linewidth = 2)+
  geom_point(data = CACA5.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
CACA5_clipped$species = "Salix caroliniana"
CACA5_flag = cc_iucn(x = CACA5.occ, range = CACA5_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
CACA5_occ_final = CACA5.occ[CACA5_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = CACA5_clipped, col = "red", linewidth = 2)+
  geom_point(data = CACA5_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/CACA5.range.pdf", width = 12, height = 8)
```

```{r}
CACA5.coords = CACA5_occ_final[c(3,2)]
rangeSize(CACA5.coords, crs = "epsg:4267")
```

Subset for Salix nigra

```{r}
SANI.occ = gbif %>%
  filter(species == "Salix nigra") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
SANI.range = st_read("../../USTreeAtlas/shp/salinigr/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(SANI.range)  <- 4267 
```

```{r}
SANI_clipped = st_intersection(SANI.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = SANI_clipped, col = "red", linewidth = 2)+
  geom_point(data = SANI.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
SANI_clipped$species = "Salix nigra"
SANI_flag = cc_iucn(x = SANI.occ, range = SANI_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
SANI_occ_final = SANI.occ[SANI_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = SANI_clipped, col = "red", linewidth = 2)+
  geom_point(data = SANI_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/SANI.range.pdf", width = 12, height = 8)
```

```{r}
SANI.coords = SANI_occ_final[c(3,2)]
rangeSize(SANI.coords, crs = "epsg:4267")
```

Subset for Sassafras albidum

```{r}
SAAL5.occ = gbif %>%
  filter(species == "Sassafras albidum") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
SAAL5.range = st_read("../../USTreeAtlas/shp/sassalbi/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(SAAL5.range)  <- 4267 
```

```{r}
SAAL5_clipped = st_intersection(SAAL5.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = SAAL5_clipped, col = "red", linewidth = 2)+
  geom_point(data = SAAL5.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
SAAL5_clipped$species = "Sassafras albidum"
SAAL5_flag = cc_iucn(x = SAAL5.occ, range = SAAL5_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
SAAL5_occ_final = SAAL5.occ[SAAL5_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = SAAL5_clipped, col = "red", linewidth = 2)+
  geom_point(data = SAAL5_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/SAAL5.range.pdf", width = 12, height = 8)
```

```{r}
SAAL5.coords = SAAL5_occ_final[c(3,2)]
rangeSize(SAAL5.coords, crs = "epsg:4267")
```

Subset for Sorbus americana

```{r}
SOAM3.occ = gbif %>%
  filter(species == "Sorbus americana") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
SOAM3.range = st_read("../../USTreeAtlas/shp/sorbamer/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(SOAM3.range)  <- 4267 
```

```{r}
SOAM3_clipped = st_intersection(SOAM3.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = SOAM3_clipped, col = "red", linewidth = 2)+
  geom_point(data = SOAM3.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
SOAM3_clipped$species = "Sorbus americana"
SOAM3_flag = cc_iucn(x = SOAM3.occ, range = SOAM3_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
SOAM3_occ_final = SOAM3.occ[SOAM3_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = SOAM3_clipped, col = "red", linewidth = 2)+
  geom_point(data = SOAM3_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/SOAM3.range.pdf", width = 12, height = 8)
```

```{r}
SOAM3.coords = SOAM3_occ_final[c(3,2)]
rangeSize(SOAM3.coords, crs = "epsg:4267")
```

Subset for Taxodium distichum (gbif) and Taxodium ascendens

```{r}
TADI2.occ = gbif %>%
  filter(species == "Taxodium distichum") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
TADI2.range = st_read("../../USTreeAtlas/shp/taxodist/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(TADI2.range)  <- 4267 
```

```{r}
TADI2_clipped = st_intersection(TADI2.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = TADI2_clipped, col = "red", linewidth = 2)+
  geom_point(data = TADI2.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
TADI2_clipped$species = "Taxodium distichum"
TADI2_flag = cc_iucn(x = TADI2.occ, range = TADI2_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
TADI2_occ_final = TADI2.occ[TADI2_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = TADI2_clipped, col = "red", linewidth = 2)+
  geom_point(data = TADI2_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/TADI2.range.pdf", width = 12, height = 8)
```

```{r}
TADI2.coords = TADI2_occ_final[c(3,2)]
rangeSize(TADI2.coords, crs = "epsg:4267")
```

Subset for Thuja occidentalis

```{r}
THOC2.occ = gbif %>%
  filter(species == "Thuja occidentalis") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
THOC2.range = st_read("../../USTreeAtlas/shp/thujocci/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(THOC2.range)  <- 4267 
```

```{r}
THOC2_clipped = st_intersection(THOC2.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = THOC2_clipped, col = "red", linewidth = 2)+
  geom_point(data = THOC2.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
THOC2_clipped$species = "Thuja occidentalis"
THOC2_flag = cc_iucn(x = THOC2.occ, range = THOC2_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
THOC2_occ_final = THOC2.occ[THOC2_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = THOC2_clipped, col = "red", linewidth = 2)+
  geom_point(data = THOC2_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/THOC2.range.pdf", width = 12, height = 8)
```

```{r}
THOC2.coords = THOC2_occ_final[c(3,2)]
rangeSize(THOC2.coords, crs = "epsg:4267")
```

Subset for Tilia americana

```{r}
TIAM.occ = gbif %>%
  filter(species == "Tilia americana") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
TIAM.range = st_read("../../USTreeAtlas/shp/tiliamer/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(TIAM.range)  <- 4267 
```

```{r}
TIAM_clipped = st_intersection(TIAM.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = TIAM_clipped, col = "red", linewidth = 2)+
  geom_point(data = TIAM.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
TIAM_clipped$species = "Tilia americana"
TIAM_flag = cc_iucn(x = TIAM.occ, range = TIAM_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
TIAM_occ_final = TIAM.occ[TIAM_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = TIAM_clipped, col = "red", linewidth = 2)+
  geom_point(data = TIAM_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/TIAM.range.pdf", width = 12, height = 8)
```

```{r}
TIAM.coords = TIAM_occ_final[c(3,2)]
rangeSize(TIAM.coords, crs = "epsg:4267")
```

Subset for Triadica sebifera. Little No range map available.

```{r}
TRSE6.occ = gbif %>%
  filter(species == "Triadica sebifera") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Get range map from BIEN

```{r}
(TRSE6.range.sf <- BIEN_ranges_load_species('Triadica sebifera'))
```
The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The BIEN ranges are WG84.

```{r}
TRSE6.range.2 = TRSE6.range.sf %>%
  st_transform(st_crs(states.map))
```

```{r}
TRSE6.range.3 = terra::vect(TRSE6.range.2)
states.map.2 = terra::vect(states.map)
```

```{r}
TRSE6.range.4 = terra::intersect(TRSE6.range.3, states.map.2)
```

```{r}
TRSE6.range.5 = st_as_sf(TRSE6.range.4)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(dat = TRSE6.range.5, col = "red", linewidth = 2)+
  geom_point(data = TRSE6.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
TRSE6.range.5$species = "Triadica sebifera"
TRSE6_flag = cc_iucn(x = TRSE6.occ, range = TRSE6.range.5, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
TRSE6_occ_final = TRSE6.occ[TRSE6_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = TRSE6.range.5, col = "red", linewidth = 2)+
  geom_point(data = TRSE6_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/TRSE6.range.pdf", width = 12, height = 8)
```

```{r}
TRSE6.coords = TRSE6_occ_final[c(3,2)]
rangeSize(TRSE6.coords, crs = "epsg:4267")
```

Subset for Tsuga canadensis

```{r}
TSCA.occ = gbif %>%
  filter(species == "Tsuga canadensis") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
TSCA.range = st_read("../../USTreeAtlas/shp/tsugcana/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(TSCA.range)  <- 4267 
```

```{r}
TSCA_clipped = st_intersection(TSCA.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = TSCA_clipped, col = "red", linewidth = 2)+
  geom_point(data = TSCA.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
TSCA_clipped$species = "Tsuga canadensis"
TSCA_flag = cc_iucn(x = TSCA.occ, range = TSCA_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
TSCA_occ_final = TSCA.occ[TSCA_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = TSCA_clipped, col = "red", linewidth = 2)+
  geom_point(data = TSCA_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/TSCA.range.pdf", width = 12, height = 8)
```

Subset for Tsuga caroliniana

```{r}
TSCA2.occ = gbif %>%
  filter(species == "Tsuga caroliniana") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
TSCA2.range = st_read("../../USTreeAtlas/shp/tsugcaro/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(TSCA2.range)  <- 4267 
```

```{r}
TSCA2_clipped = st_intersection(TSCA2.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = TSCA2_clipped, col = "red", linewidth = 2)+
  geom_point(data = TSCA2.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
TSCA2_clipped$species = "Tsuga caroliniana"
TSCA2_flag = cc_iucn(x = TSCA2.occ, range = TSCA2_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
TSCA2_occ_final = TSCA2.occ[TSCA2_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = TSCA2_clipped, col = "red", linewidth = 2)+
  geom_point(data = TSCA2_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/TSCA2.range.pdf", width = 12, height = 8)
```

```{r}
TSCA2.coords = TSCA2_occ_final[c(3,2)]
rangeSize(TSCA2.coords, crs = "epsg:4267")
```


Subset for Ulmus alata

```{r}
ULAL.occ = gbif %>%
  filter(species == "Ulmus alata") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
ULAL.range = st_read("../../USTreeAtlas/shp/ulmualat/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(ULAL.range)  <- 4267 
```

```{r}
ULAL_clipped = st_intersection(ULAL.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = ULAL_clipped, col = "red", linewidth = 2)+
  geom_point(data = ULAL.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
ULAL_clipped$species = "Ulmus alata"
ULAL_flag = cc_iucn(x = ULAL.occ, range = ULAL_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
ULAL_occ_final = ULAL.occ[ULAL_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = ULAL_clipped, col = "red", linewidth = 2)+
  geom_point(data = ULAL_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/ULAL.range.pdf", width = 12, height = 8)
```

```{r}
ULAL.coords = ULAL_occ_final[c(3,2)]
rangeSize(ULAL.coords, crs = "epsg:4267")
```

Subset for Ulmus americana

```{r}
ULAM.occ = gbif %>%
  filter(species == "Ulmus americana") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
ULAM.range = st_read("../../USTreeAtlas/shp/ulmuamer/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(ULAM.range)  <- 4267 
```

```{r}
ULAM_clipped = st_intersection(ULAM.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = ULAM_clipped, col = "red", linewidth = 2)+
  geom_point(data = ULAM.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
ULAM_clipped$species = "Ulmus americana"
ULAM_flag = cc_iucn(x = ULAM.occ, range = ULAM_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
ULAM_occ_final = ULAM.occ[ULAM_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = ULAM_clipped, col = "red", linewidth = 2)+
  geom_point(data = ULAM_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/ULAM.range.pdf", width = 12, height = 8)
```

```{r}
ULAM.coords = ULAM_occ_final[c(3,2)]
rangeSize(ULAM.coords, crs = "epsg:4267")
```

Subset for Ulmus crassifolia

```{r}
ULCR.occ = gbif %>%
  filter(species == "Ulmus crassifolia") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
ULCR.range = st_read("../../USTreeAtlas/shp/ulmucras/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(ULCR.range)  <- 4267 
```

```{r}
ULCR_clipped = st_intersection(ULCR.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = ULCR_clipped, col = "red", linewidth = 2)+
  geom_point(data = ULCR.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
ULCR_clipped$species = "Ulmus crassifolia"
ULCR_flag = cc_iucn(x = ULCR.occ, range = ULCR_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
ULCR_occ_final = ULCR.occ[ULCR_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = ULCR_clipped, col = "red", linewidth = 2)+
  geom_point(data = ULCR_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/ULCR.range.pdf", width = 12, height = 8)
```

```{r}
ULCR.coords = ULCR_occ_final[c(3,2)]
rangeSize(ULCR.coords, crs = "epsg:4267")
```

Subset for Ulmus rubra

```{r}
ULRU.occ = gbif %>%
  filter(species == "Ulmus rubra") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
ULRU.range = st_read("../../USTreeAtlas/shp/ulmurubr/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(ULRU.range)  <- 4267 
```

```{r}
ULRU_clipped = st_intersection(ULRU.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = ULRU_clipped, col = "red", linewidth = 2)+
  geom_point(data = ULRU.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
ULRU_clipped$species = "Ulmus rubra"
ULRU_flag = cc_iucn(x = ULRU.occ, range = ULRU_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
ULRU_occ_final = ULRU.occ[ULRU_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = ULRU_clipped, col = "red", linewidth = 2)+
  geom_point(data = ULRU_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/ULRU.range.pdf", width = 12, height = 8)
```

```{r}
ULRU.coords = ULRU_occ_final[c(3,2)]
rangeSize(ULRU.coords, crs = "epsg:4267")
```

Subset for Ulmus thomasii

```{r}
ULTH.occ = gbif %>%
  filter(species == "Ulmus thomasii") %>%
  dplyr::select(species,decimalLatitude,decimalLongitude)
```

Read in range map

```{r}
ULTH.range = st_read("../../USTreeAtlas/shp/ulmuthom/")
```

The projection is geographic with latitude and longitude. The datum is NAD27 which is EPSG:4267. The ellipsoid is Clarke 1866, and the transformation parameters 

```{r}
st_crs(ULTH.range)  <- 4267 
```

```{r}
ULTH_clipped = st_intersection(ULTH.range, states.map)
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = ULTH_clipped, col = "red", linewidth = 2)+
  geom_point(data = ULTH.occ, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
```

```{r}
ULTH_clipped$species = "Ulmus thomasii"
ULTH_flag = cc_iucn(x = ULTH.occ, range = ULTH_clipped, lon = "decimalLongitude", lat = "decimalLatitude", 
                    value = "flagged", buffer = 50000)
```

```{r}
ULTH_occ_final = ULTH.occ[ULTH_flag, ]
```

```{r}
ggplot()+
  geom_sf(data = states.map, fill = "white")+
  geom_sf(data = ULTH_clipped, col = "red", linewidth = 2)+
  geom_point(data = ULTH_occ_final, aes(x = decimalLongitude, y = decimalLatitude), color = "black", alpha = 0.7)+
  theme_classic()
ggsave("../Plots/ULTH.range.pdf", width = 12, height = 8)
```

```{r}
ULTH.coords = ULTH_occ_final[c(3,2)]
rangeSize(ULTH.coords, crs = "epsg:4267")
```

Merge all the final, filtered occurrence data

```{r}
gbif.range.filtered = rbind(ABBA_occ_final,ABFR_occ_final,ACBA3_occ_final,ACLE_occ_final,ACNE3_occ_final,ACNI5_occ_final,ACPE_occ_final,ACRU_occ_final,ACSA2_occ_final,ACSA3_occ_final,ACSP2_occ_final,AEFL.occ,AEGL_occ_final,AIAL.occ_final, ANGL4.occ,ASTR_occ_final,BEAL2_occ_final,BELE_occ_final,BENI_occ_final,BEPA_occ_final,BEPO_occ_final,CAAL27_occ_final,CAAQ2_occ_final,CACA18_occ_final,CACA5_occ_final,CACO15_occ_final,CADE12_occ_final,CAGL8_occ_final,CAIL2_occ_final,CAOV2_occ_final,CATE9_occ_final,CECA4_occ_final,CELA_occ_final,CEOC_occ_final,CHTH2_occ_final,COFL2_occ_final,DIVI5_occ_final,FAGR_occ_final,FRAM2_occ_final,FRCA3_occ_final,FRNI_occ_final,FRPE_occ_final,FRPR_occ_final,FRQU_occ_final,FRTE_occ_final,GLAQ_occ_final,GLTR_occ_final,GOLA_occ_final,GYDI_occ_final,ILOP_occ_final,JUCI_occ_final,JUNI_occ_final,JUVI_occ_final,LALA_occ_final,LIST2_occ_final,LITU_occ_final,MAAC_occ_final,MAFR_occ_final,MAGR4_occ_final,MAMA2_occ_final,MAPO_occ_final,MAVI2_occ_final,MORU2_occ_final,NYAQ2_occ_final,NYBI.occ,NYOG_occ_final,NYSY_occ_final,OSVI_occ_final,OXAR_occ_final,PATO2_occ_final,PEBO_occ_final,PIBA2_occ_final,PICL_occ_final,PIEC2_occ_final,PIEL_occ_final,PIGL_occ_final,PIGL2_occ_final,PIMA_occ_final,PIPA2_occ_final,PIPUS_occ_final,PIRE_occ_final,PIRI_occ_final,PIRU_occ_final,PISE_occ_final,PIST_occ_final,PITA_occ_final,PIVI2_occ_final,PLAQ_occ_final,PLOC_occ_final,POBA2_occ_final,PODE3_occ_final,POGR4_occ_final,POHE4_occ_final,POTR5_occ_final,PRAM_occ_final,PRPE2_occ_final,PRSE2_occ_final,PRVI_occ_final,QUAL_occ_final,QUBI_occ_final,QUCO2_occ_final,QUEL_occ_final,QUFA_occ_final,QUIL_occ_final,QUIM_occ_final,QUIN_occ_final,QULA2_occ_final,QULA3_occ_final,QULY_occ_final,QUMA2_occ_final,QUMA3_occ_final,QUMA6_occ_final,QUMI.occ,QUMI2_occ_final,QUMU_occ_final,QUNI_occ_final,QUPA2_occ_final,QUPA5_occ_final,QUPH_occ_final,QURU_occ_final,QUSH_occ_final,QUSIS_occ_final,QUST_occ_final,QUTE_occ_final,QUVE_occ_final,QUVI_occ_final,ROPS_occ_final,SAAL5_occ_final,SANI_occ_final,SOAM3_occ_final,TADI2_occ_final,THOC2_occ_final,TIAM_occ_final,TRSE6_occ_final,TSCA_occ_final,TSCA2_occ_final,ULAL_occ_final,ULAM_occ_final,ULCR_occ_final,ULRU_occ_final,ULTH_occ_final)
```

```{r}
#write.csv(gbif.range.filtered, file = "../Formatted.Data/final.gbif.data.csv")
```

